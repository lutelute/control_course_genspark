# 第2回：PID制御

## 学習目標
- PID制御の基本原理と各要素の役割を理解する
- 比例（P）、積分（I）、微分（D）動作の特性を把握する
- PIDパラメータの調整方法を学ぶ

## 1. はじめに

**PID制御**（Proportional-Integral-Derivative Control）は、産業界で最も広く使用されている制御手法です。その理由は：
- 構造がシンプルで理解しやすい
- パラメータ調整が比較的容易
- 多くの実用システムに対して良好な性能を発揮
- 実装が容易でコストが低い

## 2. PID制御の基本構造

### 2.1 制御系の構成

```
r(t) ─→ (+ ) ─→ [ PID制御器 ] ─→ u(t) ─→ [ プラント ] ─→ y(t)
       ─ ↑                                                    │
         └────────────────────────────────────────────────────┘
```

- $r(t)$：目標値（設定値、reference）
- $e(t) = r(t) - y(t)$：偏差（error）
- $u(t)$：制御入力（操作量）
- $y(t)$：出力（制御量）

### 2.2 PID制御則

PID制御器の出力は以下の式で表されます：

$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

または、各項を分けて書くと：

$$u(t) = u_P(t) + u_I(t) + u_D(t)$$

ここで：
- $u_P(t) = K_p e(t)$：比例動作（P動作）
- $u_I(t) = K_i \int_0^t e(\tau) d\tau$：積分動作（I動作）
- $u_D(t) = K_d \frac{de(t)}{dt}$：微分動作（D動作）

### 2.3 標準形と並列形

**標準形（直列形、ISA形式）：**
$$u(t) = K_p \left[ e(t) + \frac{1}{T_i}\int_0^t e(\tau) d\tau + T_d \frac{de(t)}{dt} \right]$$

- $K_p$：比例ゲイン
- $T_i$：積分時間
- $T_d$：微分時間

**並列形：**
$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

変換関係：
- $K_i = K_p / T_i$
- $K_d = K_p \cdot T_d$

## 3. 各要素の役割と特性

### 3.1 比例動作（P動作）

**特徴：**
- 偏差に比例した制御出力を生成
- 応答が速い
- 残留偏差（オフセット）が残る

**制御則：**
$$u_P(t) = K_p e(t)$$

**効果：**
- $K_p$ を大きくすると応答が速くなるが、オーバーシュートが増加
- $K_p$ を小さくすると応答が遅くなるが、安定性が向上

### 3.2 積分動作（I動作）

**特徴：**
- 偏差の累積に応じた制御出力を生成
- 残留偏差を除去（定常偏差ゼロ）
- 応答が遅くなる傾向
- 積分飽和（windup）の問題

**制御則：**
$$u_I(t) = K_i \int_0^t e(\tau) d\tau$$

**効果：**
- 定常偏差を完全に除去
- 過度に強いと振動や不安定化の原因に

### 3.3 微分動作（D動作）

**特徴：**
- 偏差の変化率に応じた制御出力を生成
- 予測的な制御（先読み効果）
- オーバーシュートの抑制
- ノイズに敏感

**制御則：**
$$u_D(t) = K_d \frac{de(t)}{dt}$$

**効果：**
- 過渡応答の改善
- オーバーシュートの減少
- 整定時間の短縮

## 4. PID制御の伝達関数表現

ラプラス変換を用いると、PID制御器の伝達関数は：

**並列形：**
$$C(s) = K_p + \frac{K_i}{s} + K_d s$$

**標準形：**
$$C(s) = K_p \left( 1 + \frac{1}{T_i s} + T_d s \right)$$

## 5. PIDパラメータの調整方法

### 5.1 Ziegler-Nichols法（限界感度法）

**手順：**
1. I動作とD動作を無効にし、P制御のみとする（$K_i = 0, K_d = 0$）
2. $K_p$ を徐々に増加させ、システムが持続振動を始める限界ゲイン $K_u$ を見つける
3. そのときの振動周期を $T_u$ とする
4. 以下の表に従ってパラメータを設定

| 制御器タイプ | $K_p$ | $T_i$ | $T_d$ |
|------------|-------|-------|-------|
| P | $0.5 K_u$ | ∞ | 0 |
| PI | $0.45 K_u$ | $T_u/1.2$ | 0 |
| PID | $0.6 K_u$ | $T_u/2$ | $T_u/8$ |

### 5.2 Ziegler-Nichols法（ステップ応答法）

**手順：**
1. システムにステップ入力を加える
2. ステップ応答から以下のパラメータを測定：
   - $L$：むだ時間
   - $T$：時定数
   - $K$：定常ゲイン
3. 以下の表に従ってパラメータを設定

| 制御器タイプ | $K_p$ | $T_i$ | $T_d$ |
|------------|-------|-------|-------|
| P | $T/(KL)$ | ∞ | 0 |
| PI | $0.9T/(KL)$ | $3L$ | 0 |
| PID | $1.2T/(KL)$ | $2L$ | $0.5L$ |

### 5.3 手動調整法

**基本的な調整の流れ：**

1. **すべてのゲインをゼロに設定**
2. **比例ゲイン $K_p$ の調整**
   - $K_p$ を徐々に増加
   - 応答が速くなるが振動的になる手前で止める
3. **積分ゲイン $K_i$ の追加**
   - $K_i$ を徐々に増加
   - 定常偏差が除去されるまで
   - 振動が大きくなりすぎないように注意
4. **微分ゲイン $K_d$ の追加**
   - $K_d$ を徐々に増加
   - オーバーシュートが減少するまで
   - ノイズに敏感にならない範囲で

**各パラメータの影響：**

| パラメータ増加 | 立ち上がり時間 | オーバーシュート | 整定時間 | 定常偏差 |
|------------|------------|--------------|---------|---------|
| $K_p$ | 減少 | 増加 | 小変化 | 減少 |
| $K_i$ | 減少 | 増加 | 増加 | 除去 |
| $K_d$ | 小変化 | 減少 | 減少 | 小変化 |

## 6. PID制御の問題点と対策

### 6.1 積分飽和（Integral Windup）

**問題：**
- 大きな偏差が長時間続くと積分項が過大に蓄積
- 飽和後に大きなオーバーシュートが発生

**対策：**
- アンチワインドアップ機構の実装
- 積分項の上下限リミット設定
- 条件付き積分（偏差が小さいときのみ積分）

### 6.2 微分キック（Derivative Kick）

**問題：**
- 目標値の急変時に微分項が大きなスパイクを発生

**対策：**
- 目標値の微分を使わず、出力の微分を使用
- 微分フィルタの導入

### 6.3 ノイズへの感度

**問題：**
- 微分動作がセンサノイズを増幅

**対策：**
- ローパスフィルタの導入
- 不完全微分の使用

## 7. デジタル実装

離散時間系でのPID制御器の実装：

**差分方程式：**
$$u[k] = K_p e[k] + K_i T_s \sum_{j=0}^{k} e[j] + K_d \frac{e[k] - e[k-1]}{T_s}$$

ここで、$T_s$ はサンプリング周期です。

**速度形アルゴリズム：**
$$\Delta u[k] = u[k] - u[k-1]$$
$$\Delta u[k] = K_p(e[k] - e[k-1]) + K_i T_s e[k] + K_d \frac{e[k] - 2e[k-1] + e[k-2]}{T_s}$$

## 8. 具体例

### 例1：温度制御系

**システム：** 電気ヒーターによる炉の温度制御

**パラメータ：**
- 目標温度：200°C
- 測定温度範囲：0-300°C
- 制御周期：1秒

**PID設定例：**
- $K_p = 2.0$
- $K_i = 0.5$
- $K_d = 0.1$

### 例2：モータ速度制御

**システム：** DCモータの回転速度制御

**パラメータ：**
- 目標速度：1000 rpm
- 測定範囲：0-2000 rpm
- 制御周期：10 ms

**PID設定例：**
- $K_p = 0.8$
- $K_i = 0.2$
- $K_d = 0.05$

## 9. 演習問題

### 問題1
1次遅れ系 $G(s) = \frac{1}{s+1}$ に対して、P制御、PI制御、PID制御をそれぞれ適用した場合の閉ループ伝達関数を求めよ。

### 問題2
Ziegler-Nicholsの限界感度法において、$K_u = 4.0$、$T_u = 2.0$ [s] が得られた。PID制御器のパラメータ $K_p$、$T_i$、$T_d$ を求めよ。

### 問題3
以下の状況でPIDパラメータをどのように調整すべきか説明せよ：
a) オーバーシュートが大きすぎる
b) 定常偏差が残る
c) 応答が遅すぎる

## 10. まとめ

- PID制御は3つの基本動作（P, I, D）の組み合わせ
- P動作：応答の速さ、I動作：定常偏差の除去、D動作：安定性の向上
- パラメータ調整にはZiegler-Nichols法などの体系的手法がある
- 積分飽和や微分キックなどの問題に対する対策が重要
- デジタル実装では離散化に注意が必要

## 次回予告

次回は、**状態方程式の解**について学びます。線形システムの時間応答を解析的に求める方法を習得します。

## 参考文献

1. Karl J. Åström & Tore Hägglund, "PID Controllers: Theory, Design, and Tuning"
2. 須田信英『PID制御』朝倉書店
3. 足立修一『MATLABによる制御工学』東京電機大学出版局
