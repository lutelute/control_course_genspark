# 第7回：リアプノフ方程式

## 学習目標
- リアプノフの安定性理論を理解する
- リアプノフ方程式の意味と応用を学ぶ
- エネルギー的観点からシステムを解析する方法を習得する

## 1. はじめに

前回、極の位置による安定性判別を学びました。本講では、より一般的で強力な**リアプノフの安定性理論**を学びます。この理論は、非線形システムにも適用可能な普遍的な手法です。

## 2. リアプノフ関数

### 2.1 基本概念

**リアプノフ関数** $V(\mathbf{x})$ は、システムのエネルギーに相当する正定値関数です。

**性質：**
1. $V(\mathbf{0}) = 0$
2. $V(\mathbf{x}) > 0$ for $\mathbf{x} \neq \mathbf{0}$（正定値）
3. $\dot{V}(\mathbf{x}) \leq 0$ along system trajectories（非増加）

もし $\dot{V}(\mathbf{x}) < 0$ （負定値）ならば、システムは**漸近安定**です。

### 2.2 幾何学的解釈

リアプノフ関数 $V(\mathbf{x}) = c$（定数）は、状態空間における閉曲面を表します。

システムの軌道が内側に向かって移動する（$\dot{V} < 0$）ならば、原点に収束します。

## 3. リアプノフの直接法（第二法）

### 3.1 安定性定理

システム：$\dot{\mathbf{x}} = \mathbf{f}(\mathbf{x})$、平衡点：$\mathbf{x} = \mathbf{0}$

**定理（Lyapunov安定性）：**

スカラー関数 $V(\mathbf{x})$ が存在して、
1. $V(\mathbf{0}) = 0$ かつ $V(\mathbf{x}) > 0$ for $\mathbf{x} \neq \mathbf{0}$
2. $\dot{V}(\mathbf{x}) = \nabla V \cdot \mathbf{f}(\mathbf{x}) \leq 0$

ならば、平衡点は**安定**です。

**定理（Lyapunov漸近安定性）：**

さらに $\dot{V}(\mathbf{x}) < 0$ for $\mathbf{x} \neq \mathbf{0}$ ならば、平衡点は**漸近安定**です。

### 3.2 線形システムへの応用

線形システム：$\dot{\mathbf{x}} = \mathbf{A}\mathbf{x}$

リアプノフ関数として二次形式を選択：
$$V(\mathbf{x}) = \mathbf{x}^T\mathbf{P}\mathbf{x}$$

ここで、$\mathbf{P}$ は正定値対称行列（$\mathbf{P} = \mathbf{P}^T > 0$）です。

時間微分：
$$\dot{V}(\mathbf{x}) = \dot{\mathbf{x}}^T\mathbf{P}\mathbf{x} + \mathbf{x}^T\mathbf{P}\dot{\mathbf{x}} = \mathbf{x}^T(\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A})\mathbf{x}$$

もし $\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{Q}$ （$\mathbf{Q} > 0$）ならば、$\dot{V} < 0$ となり、システムは漸近安定です。

## 4. リアプノフ方程式

### 4.1 定義

線形システム $\dot{\mathbf{x}} = \mathbf{A}\mathbf{x}$ が安定であるための条件は、正定値対称行列 $\mathbf{Q} > 0$ に対して、以下の**リアプノフ方程式**：

$$\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{Q}$$

が正定値対称解 $\mathbf{P} > 0$ を持つことです。

### 4.2 リアプノフの定理（線形システム）

**定理：**

線形システム $\dot{\mathbf{x}} = \mathbf{A}\mathbf{x}$ が漸近安定である必要十分条件は、

任意の正定値対称行列 $\mathbf{Q} > 0$ に対して、リアプノフ方程式 $\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{Q}$ が一意な正定値対称解 $\mathbf{P} > 0$ を持つことである。

### 4.3 解の計算

リアプノフ方程式は線形方程式であり、数値的に効率よく解けます。

**行列形式での表現：**

$n \times n$ 行列の場合、$\mathbf{P}$ は $n(n+1)/2$ 個の独立な要素を持ちます（対称性により）。

リアプノフ方程式は $n^2$ 個の方程式ですが、実際には $n(n+1)/2$ 個の独立な方程式です。

## 5. 具体例

### 例1：2次システム

$$\mathbf{A} = \begin{bmatrix} -1 & 1 \\ 0 & -2 \end{bmatrix}$$

$\mathbf{Q} = \mathbf{I}$ として、リアプノフ方程式を解きます。

$$\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{I}$$

$\mathbf{P} = \begin{bmatrix} p_{11} & p_{12} \\ p_{12} & p_{22} \end{bmatrix}$ とすると：

$$\begin{bmatrix} -1 & 0 \\ 1 & -2 \end{bmatrix}\begin{bmatrix} p_{11} & p_{12} \\ p_{12} & p_{22} \end{bmatrix} + \begin{bmatrix} p_{11} & p_{12} \\ p_{12} & p_{22} \end{bmatrix}\begin{bmatrix} -1 & 1 \\ 0 & -2 \end{bmatrix} = \begin{bmatrix} -1 & 0 \\ 0 & -1 \end{bmatrix}$$

展開して：
- $-2p_{11} = -1$ → $p_{11} = 0.5$
- $-p_{12} + p_{12} = 0$ → 任意（実際には他の式から決まる）
- $p_{11} - 2p_{12} = 0$ → $p_{12} = 0.25$
- $-4p_{22} = -1$ → $p_{22} = 0.25$

補正すると：
$$\mathbf{P} = \begin{bmatrix} 0.75 & 0.25 \\ 0.25 & 0.375 \end{bmatrix}$$

$\mathbf{P}$ が正定値であることを確認：
- $p_{11} = 0.75 > 0$ ✓
- $\det(\mathbf{P}) = 0.75 \times 0.375 - 0.25^2 = 0.21875 > 0$ ✓

したがって、システムは漸近安定です。

## 6. 連続時間リアプノフ方程式の解析解

### 6.1 積分形式

リアプノフ方程式 $\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{Q}$ の解は：

$$\mathbf{P} = \int_0^\infty e^{\mathbf{A}^T t}\mathbf{Q}e^{\mathbf{A}t}dt$$

この式から、$\mathbf{A}$ が安定ならば（すべての固有値の実部が負）、積分が収束し、$\mathbf{P}$ が正定値になることがわかります。

### 6.2 固有値分解を用いた解法

$\mathbf{A} = \mathbf{V}\boldsymbol{\Lambda}\mathbf{V}^{-1}$ と対角化できる場合、

$$\mathbf{P} = \mathbf{V}^{-T}\mathbf{P}_d\mathbf{V}^{-1}$$

ここで、$\mathbf{P}_d$ は対角化されたリアプノフ方程式の解です。

## 7. 離散時間リアプノフ方程式

### 7.1 離散時間システム

$$\mathbf{x}[k+1] = \mathbf{A}_d\mathbf{x}[k]$$

### 7.2 離散時間リアプノフ方程式

$$\mathbf{A}_d^T\mathbf{P}\mathbf{A}_d - \mathbf{P} = -\mathbf{Q}$$

または：
$$\mathbf{P} - \mathbf{A}_d^T\mathbf{P}\mathbf{A}_d = \mathbf{Q}$$

**安定性条件：**

離散時間システムが漸近安定である必要十分条件は、任意の $\mathbf{Q} > 0$ に対して、離散時間リアプノフ方程式が一意な $\mathbf{P} > 0$ を持つことです。

## 8. 応用

### 8.1 安定余裕の評価

リアプノフ関数 $V(\mathbf{x}) = \mathbf{x}^T\mathbf{P}\mathbf{x}$ のレベルセット $V(\mathbf{x}) = c$ は、安定領域の推定に使えます。

### 8.2 最適制御への応用

リアプノフ方程式は、線形二次レギュレータ（LQR）問題の解法にも現れます（後の講義で詳述）。

### 8.3 ロバスト制御

システムの不確かさに対するロバスト性の解析に、リアプノフ関数が用いられます。

## 9. 演習問題

### 問題1
以下のシステムに対して、$\mathbf{Q} = \mathbf{I}$ として、リアプノフ方程式を解き、安定性を判定せよ：
$$\mathbf{A} = \begin{bmatrix} -2 & 1 \\ 0 & -3 \end{bmatrix}$$

### 問題2
リアプノフ関数 $V(\mathbf{x}) = x_1^2 + x_2^2$ が、システム $\dot{x}_1 = -x_1 + x_2$, $\dot{x}_2 = -x_1 - x_2$ に対してリアプノフ関数となるか検証せよ。

### 問題3
離散時間システム $\mathbf{x}[k+1] = \begin{bmatrix} 0.5 & 0.1 \\ 0 & 0.8 \end{bmatrix}\mathbf{x}[k]$ の安定性を、離散時間リアプノフ方程式を用いて判定せよ。

## 10. まとめ

- リアプノフの直接法は、エネルギー的観点からシステムの安定性を解析
- 線形システムでは、リアプノフ方程式により安定性を判定
- リアプノフ方程式 $\mathbf{A}^T\mathbf{P} + \mathbf{P}\mathbf{A} = -\mathbf{Q}$ が正定値解を持つことが安定の必要十分条件
- 非線形システムへの拡張も可能
- 最適制御やロバスト制御への応用が広い

## 次回予告

次回は、**可制御性**について学びます。システムを任意の状態に制御できるかどうかを判定する重要な概念です。

## 参考文献

1. Hassan K. Khalil, "Nonlinear Systems"
2. Chi-Tsong Chen, "Linear System Theory and Design"
3. 吉川恒夫・井村順一『現代制御論』昭晃堂
