# 第2回：PID制御

## 学習目標
- PID制御の基本原理と各要素の役割を理解する
- 比例（P）、積分（I）、微分（D）動作の特性を把握する
- PIDパラメータの調整方法を学ぶ
- 実際の制御問題でのPID制御の適用方法を習得する

## 1. はじめに：なぜPID制御なのか？

### 1.1 日常生活のフィードバック制御

私たちは日常生活で無意識にフィードバック制御を行っています：

**例1：お風呂の温度調整**
- 目標：40℃のお湯
- 現在：38℃のお湯（偏差 = -2℃）
- 行動：熱湯を追加（制御入力）

**例2：自動車の運転**
- 目標：車線の中央
- 現在：右側にずれている（偏差）
- 行動：ハンドルを左に切る（制御入力）

これらの自然な行動パターンがPID制御の基本原理と同じです。

### 1.2 PID制御が普及している理由

**PID制御**（Proportional-Integral-Derivative Control）は、産業界で最も広く使用されている制御手法です。統計によると、産業用制御器の**90%以上**がPID制御ベースとされています。

**普及の理由：**
- **直感的理解**：人間の制御行動パターンに近い
- **シンプル構造**：3つのパラメータのみで制御
- **実証された性能**：多くの実用システムで良好な結果
- **実装の容易さ**：アナログ回路でも簡単に実現可能
- **コスト効果**：高価な解析不要で実用的性能を達成

### 1.3 PID制御の本質

PID制御の本質は**「過去・現在・未来」**への同時対応：
- **現在の状況**に対する即座の反応（**P**：比例）
- **過去の蓄積**への継続的な補正（**I**：積分）
- **未来の予測**による先読み制御（**D**：微分）

## 2. PID制御の基本構造

### 2.1 フィードバック制御の基本概念

まず、フィードバック制御の基本的な仕組みを理解しましょう。

**フィードバック制御の原理：**
1. **目標値を設定**する
2. **現在の状態を測定**する  
3. **偏差（差）を計算**する：偏差 = 目標値 - 現在値
4. **偏差に基づいて制御入力を決定**する
5. **システムに制御入力を適用**する
6. **結果を観測**して1に戻る

### 2.2 制御系の構成と用語

```
目標値      偏差        制御入力              出力
r(t) ─→ (+) ─→ [ PID制御器 ] ─→ u(t) ─→ [ プラント ] ─→ y(t)
        ↑ -                                                │
        └─────────────── フィードバック ────────────────────┘
```

**各要素の詳細説明：**

- **$r(t)$（目標値、Reference）**：
  - 制御したい値（例：温度40℃、速度60km/h）
  - 「こうなって欲しい」という理想値
  
- **$y(t)$（出力、Output）**：
  - 実際に測定される値
  - センサで観測される現在の状態
  
- **$e(t)$（偏差、Error）**：
  - $e(t) = r(t) - y(t)$
  - 目標と現実のギャップ
  - この偏差をゼロにするのがPID制御の目的
  
- **$u(t)$（制御入力、Control Input）**：
  - システムに加える操作量
  - 例：ヒーターの電力、モータの電圧
  
- **プラント（Plant）**：
  - 制御対象となるシステム
  - 例：温度制御なら加熱装置とタンク

### 2.3 PID制御則の数学的表現

#### 基本形（並列形）

PID制御器の出力は以下の式で表されます：

$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

これを3つの項に分解すると：

$$u(t) = u_P(t) + u_I(t) + u_D(t)$$

**各項の意味：**
- **$u_P(t) = K_p e(t)$**：**比例項**（P動作）
  - 現在の偏差に比例した制御
  - 偏差が大きいほど強く制御
  
- **$u_I(t) = K_i \int_0^t e(\tau) d\tau$**：**積分項**（I動作）
  - 過去の偏差の累積に比例した制御
  - 持続的な偏差を解消
  
- **$u_D(t) = K_d \frac{de(t)}{dt}$**：**微分項**（D動作）
  - 偏差の変化率に比例した制御
  - 急激な変化を予測して対応

#### なぜこの3つなのか？

**時間的な観点から：**
- **P項**：**現在**の状況への対応
- **I項**：**過去**の蓄積への対応  
- **D項**：**未来**の変化への対応

この組み合わせにより、時間軸全体にわたって最適な制御を実現します。

### 2.3 標準形と並列形

**標準形（直列形、ISA形式）：**
$$u(t) = K_p \left[ e(t) + \frac{1}{T_i}\int_0^t e(\tau) d\tau + T_d \frac{de(t)}{dt} \right]$$

- $K_p$：比例ゲイン
- $T_i$：積分時間
- $T_d$：微分時間

**並列形：**
$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

変換関係：
- $K_i = K_p / T_i$
- $K_d = K_p \cdot T_d$

## 3. 各要素の役割と特性：詳細解説

### 3.1 比例動作（P動作）：「現在への対応」

#### 3.1.1 基本概念

**比例動作**は、現在の偏差に**直接比例**した制御を行います。

**制御則：**
$$u_P(t) = K_p e(t)$$

**日常生活の例：**
- **お風呂の温度調整**：「2℃低い」→「強めに熱湯を入れる」
- **車の運転**：「大きく右にずれた」→「大きく左にハンドルを切る」

#### 3.1.2 $K_p$（比例ゲイン）の効果

**$K_p$の物理的意味：**
- $K_p$ = 「1単位の偏差に対してどれだけ強く制御するか」
- 単位：[制御入力の単位]/[偏差の単位]

**$K_p$を大きくした場合：**
- ✅ **応答が速い**：偏差に対して強く反応
- ✅ **立ち上がり時間の短縮**
- ❌ **オーバーシュート増加**：行き過ぎが発生
- ❌ **振動しやすい**：過敏な反応

**$K_p$を小さくした場合：**
- ✅ **安定性向上**：振動が少ない
- ✅ **滑らかな応答**
- ❌ **応答が遅い**：目標値到達に時間がかかる
- ❌ **残留偏差が大きい**：完全に目標に到達しない

#### 3.1.3 P動作だけの問題点

**残留偏差（定常偏差）の発生：**

なぜ残留偏差が残るのか？定常状態を考えてみましょう：
- 定常状態では $u_P = K_p e_{ss}$ （一定値）
- システムを駆動するには制御入力が必要
- したがって $e_{ss} \neq 0$ となる

**具体例：**
温度制御で外気温度が変化した場合、新しい平衡点で偏差が残る。

### 3.2 積分動作（I動作）：「過去への対応」

#### 3.2.1 基本概念

**積分動作**は、過去の偏差の**蓄積**に基づいて制御を行います。

**制御則：**
$$u_I(t) = K_i \int_0^t e(\tau) d\tau$$

**物理的イメージ：**
- 偏差が持続すると、その「借金」がどんどん累積
- この借金を返済するために制御出力を増加
- 借金がゼロ（偏差の積分がゼロ）になるまで動作継続

#### 3.2.2 積分項の役割

**定常偏差の完全除去：**

なぜ積分項で定常偏差がゼロになるのか？

定常状態では：
- $u_I(t) = K_i \int_0^t e(\tau) d\tau$ = 一定値
- これが成り立つためには $e(t) = 0$ でなければならない
- なぜなら、$e(t) \neq 0$ なら積分値は増加し続けるから

**日常生活の例：**
- **貯金**：毎月少しずつでも貯金すれば、いずれ大きな金額になる
- **勉強**：毎日少しずつでも積み重ねれば、大きな力になる

#### 3.2.3 $K_i$（積分ゲイン）の効果

**$K_i$の物理的意味：**
- 「偏差の蓄積にどれだけ敏感に反応するか」
- 大きいほど積分の効果が強い

**$K_i$を大きくした場合：**
- ✅ **定常偏差除去が速い**
- ❌ **オーバーシュート増加**
- ❌ **振動しやすい**
- ❌ **積分飽和のリスク**

**$K_i$を小さくした場合：**
- ✅ **安定性向上**
- ❌ **定常偏差除去が遅い**

#### 3.2.4 積分飽和（Integral Windup）問題

**積分飽和とは：**
制御出力に上下限がある場合、積分項が過大になって制御性能が悪化する現象。

**発生メカニズム：**
1. 大きな目標値変化や外乱が発生
2. 制御出力が飽和（上限または下限に張り付き）
3. しかし偏差は残るので積分項が増加し続ける
4. 偏差がゼロになっても積分項が大きいままで過渡特性が悪化

**対策：**
- アンチワインドアップ機構の実装
- 積分項に上下限を設ける

### 3.3 微分動作（D動作）：「未来への対応」

#### 3.3.1 基本概念

**微分動作**は、偏差の**変化速度**に基づいて制御を行います。

**制御則：**
$$u_D(t) = K_d \frac{de(t)}{dt}$$

**物理的イメージ：**
- 偏差が急激に変化しそうになると、それを予測して先回り
- 「このままだと大きくずれそう」→「早めに対処」

#### 3.3.2 微分項の効果

**予測制御の実現：**

なぜ微分項で予測ができるのか？

偏差の変化率 $\frac{de(t)}{dt}$ は：
- 正：偏差が増加中（状況が悪化）
- 負：偏差が減少中（状況が改善）
- ゼロ：偏差が一定（変化なし）

この情報を使って、偏差が大きくなる前に制御を強化。

**日常生活の例：**
- **ブレーキ**：前の車が近づいてくる速度を見て、早めにブレーキ
- **投資**：株価の変化の勢いを見て、早めに売買判断

#### 3.3.3 $K_d$（微分ゲイン）の効果

**$K_d$を大きくした場合：**
- ✅ **オーバーシュート抑制**：行き過ぎを予測して抑制
- ✅ **応答の改善**：素早い立ち上がりと安定化の両立
- ❌ **ノイズに敏感**：測定ノイズを増幅
- ❌ **高周波振動**：不必要な細かい制御

**$K_d$を小さくした場合：**
- ✅ **ノイズに強い**
- ❌ **オーバーシュートが大きい**

#### 3.3.4 微分動作の実装上の注意

**純粋な微分の問題点：**
- ノイズを大幅に増幅
- 高周波で不安定化

**実用的な解決策：**
- **不完全微分**：$G_d(s) = \frac{sT_d}{1 + s\alpha T_d}$ （$\alpha = 0.1$ 程度）
- **ローパスフィルタ**との組み合わせ

**制御則：**
$$u_D(t) = K_d \frac{de(t)}{dt}$$

**効果：**
- 過渡応答の改善
- オーバーシュートの減少
- 整定時間の短縮

## 4. PID制御の伝達関数表現

ラプラス変換を用いると、PID制御器の伝達関数は：

**並列形：**
$$C(s) = K_p + \frac{K_i}{s} + K_d s$$

**標準形：**
$$C(s) = K_p \left( 1 + \frac{1}{T_i s} + T_d s \right)$$

## 5. PIDパラメータの調整方法：実践的アプローチ

### 5.1 調整の基本方針

PIDパラメータの調整は**技能**であり**科学**でもあります。初学者には以下の段階的アプローチを推奨します。

#### 5.1.1 調整前の準備

**1. システムの理解**
- 制御対象の特性を把握（遅い系？速い系？）
- 安全な動作範囲の確認
- センサとアクチュエータの特性確認

**2. 目標設定**
- 応答速度の要求
- オーバーシュートの許容範囲
- 定常精度の要求

**3. 初期設定**
- すべてのゲインを0に設定
- 制御出力の上下限設定
- サンプリング周期の設定

### 5.2 段階的手動調整法（推奨）

#### Step 1: P制御の調整

**目標：** システムの基本的な応答特性を掴む

**手順：**
1. $K_i = 0, K_d = 0$ に設定
2. $K_p = 0.1$ 程度から開始
3. $K_p$ を徐々に増加（約1.5倍ずつ）
4. 以下の現象を観察：
   - $K_p$ 小：応答が遅い、残留偏差大
   - $K_p$ 適正：適度な応答速度、多少の残留偏差
   - $K_p$ 大：速い応答、大きなオーバーシュート
   - $K_p$ 過大：持続振動発生

**適正値の判断基準：**
- オーバーシュート < 20%
- 振動が2-3回で収束
- 残留偏差は無視（次のステップで解決）

#### Step 2: I動作の追加

**目標：** 定常偏差を除去

**手順：**
1. P制御で得られた $K_p$ の0.8倍程度を設定
2. $K_i$ を小さな値から開始（$K_i = K_p/100$ 程度）
3. $K_i$ を徐々に増加
4. 以下の効果を確認：
   - 定常偏差の改善
   - オーバーシュートの変化
   - 振動の有無

**適正値の判断基準：**
- 定常偏差がほぼゼロ
- オーバーシュートが許容範囲内
- 安定した整定

#### Step 3: D動作の追加（必要に応じて）

**目標：** オーバーシュートの抑制と応答の改善

**手順：**
1. $K_d$ を小さな値から開始（$K_d = K_p \times 0.01$ 程度）
2. オーバーシュートの減少を確認
3. ノイズの増幅に注意

**注意点：**
- D動作は必ずしも必要ではない
- ノイズが多い環境では使用しない
- 過度のD動作は高周波振動の原因

### 5.3 Ziegler-Nichols法（限界感度法）

**歴史的に重要な調整法**ですが、**初学者には推奨しません**。理由：
- 系を不安定にする必要がある（危険）
- 現代のシステムには過度に積極的
- ロバスト性に欠ける

**参考として手順を示します：**

1. **I動作とD動作を無効**にし、P制御のみ
2. **$K_p$ を徐々に増加**させ、持続振動が発生する**限界ゲイン $K_u$** を発見
3. **振動周期 $T_u$** を測定
4. **以下の表に従って設定**：

| 制御器 | $K_p$ | $T_i$ | $T_d$ |
|-------|-------|-------|-------|
| P | $0.5 K_u$ | ∞ | 0 |
| PI | $0.45 K_u$ | $T_u/1.2$ | 0 |
| PID | $0.6 K_u$ | $T_u/2$ | $T_u/8$ |

### 5.4 現代的な調整指針

#### 5.4.1 応答特性に基づく調整

**各パラメータの影響の詳細理解：**

| パラメータ↑ | 立上り | ﾋｭｰｼｭｰﾄ | 整定 | 定常偏差 | 備考 |
|-----------|-------|--------|------|---------|------|
| $K_p$ | ↓速く | ↑増加 | ± | ↓減少 | 基本性能決定 |
| $K_i$ | ↓速く | ↑増加 | ↑遅く | ゼロ | 精度向上 |
| $K_d$ | ± | ↓減少 | ↓速く | ± | 安定性向上 |

#### 5.4.2 用途別推奨設定

**位置決め制御（精度重視）：**
- PI制御推奨（D項はノイズで不安定化）
- $K_p$：中程度、$K_i$：小〜中

**速度制御（応答性重視）：**
- PID制御推奨
- $K_p$：大、$K_i$：中、$K_d$：小

**温度制御（安定性重視）：**
- PI制御推奨
- $K_p$：小〜中、$K_i$：小

### 5.5 調整時のトラブルシューティング

#### 問題1: 振動が止まらない

**原因と対策：**
- $K_p$ 過大 → 減少
- $K_i$ 過大 → 減少  
- $K_d$ 過大 → 減少
- ノイズ → フィルタ追加

#### 問題2: 応答が遅すぎる

**原因と対策：**
- $K_p$ 不足 → 増加
- $K_i$ 不足 → 増加
- システム限界 → ハードウェア改良

#### 問題3: オーバーシュート過大

**原因と対策：**
- $K_p$ 過大 → 減少
- $K_i$ 過大 → 減少
- $K_d$ 不足 → 増加（ノイズ許容時）

#### 問題4: 定常偏差が残る

**原因と対策：**
- $K_i$ 不足 → 増加
- 積分飽和 → アンチワインドアップ
- 非線形性 → ゲインスケジューリング

### 5.6 実際の調整例

#### 例：温度制御系の調整

**システム：** 電気炉の温度制御（目標200℃）

**初期観察：**
- ステップ応答の立上り時間：約30秒
- オーバーシュートなし（P制御時）
- 定常偏差：約10℃

**調整過程：**

1. **P制御調整**
   - $K_p = 1.0$ → 立上り30秒、定常偏差10℃
   - $K_p = 2.0$ → 立上り20秒、定常偏差5℃
   - $K_p = 4.0$ → 立上り15秒、定常偏差3℃、軽微振動
   - **選択：$K_p = 3.0$**（バランス点）

2. **I動作追加**
   - $K_i = 0.1$ → 定常偏差1℃に改善
   - $K_i = 0.2$ → 定常偏差ほぼゼロ
   - $K_i = 0.3$ → オーバーシュート5℃
   - **選択：$K_i = 0.2$**

3. **最終設定**
   - $K_p = 3.0, K_i = 0.2, K_d = 0$（D項不使用）
   - 性能：立上り18秒、オーバーシュート2℃、定常偏差0℃

## 6. PID制御の問題点と対策

### 6.1 積分飽和（Integral Windup）

**問題：**
- 大きな偏差が長時間続くと積分項が過大に蓄積
- 飽和後に大きなオーバーシュートが発生

**対策：**
- アンチワインドアップ機構の実装
- 積分項の上下限リミット設定
- 条件付き積分（偏差が小さいときのみ積分）

### 6.2 微分キック（Derivative Kick）

**問題：**
- 目標値の急変時に微分項が大きなスパイクを発生

**対策：**
- 目標値の微分を使わず、出力の微分を使用
- 微分フィルタの導入

### 6.3 ノイズへの感度

**問題：**
- 微分動作がセンサノイズを増幅

**対策：**
- ローパスフィルタの導入
- 不完全微分の使用

## 7. デジタル実装

離散時間系でのPID制御器の実装：

**差分方程式：**
$$u[k] = K_p e[k] + K_i T_s \sum_{j=0}^{k} e[j] + K_d \frac{e[k] - e[k-1]}{T_s}$$

ここで、$T_s$ はサンプリング周期です。

**速度形アルゴリズム：**
$$\Delta u[k] = u[k] - u[k-1]$$
$$\Delta u[k] = K_p(e[k] - e[k-1]) + K_i T_s e[k] + K_d \frac{e[k] - 2e[k-1] + e[k-2]}{T_s}$$

## 8. 具体例

### 例1：温度制御系

**システム：** 電気ヒーターによる炉の温度制御

**パラメータ：**
- 目標温度：200°C
- 測定温度範囲：0-300°C
- 制御周期：1秒

**PID設定例：**
- $K_p = 2.0$
- $K_i = 0.5$
- $K_d = 0.1$

### 例2：モータ速度制御

**システム：** DCモータの回転速度制御

**パラメータ：**
- 目標速度：1000 rpm
- 測定範囲：0-2000 rpm
- 制御周期：10 ms

**PID設定例：**
- $K_p = 0.8$
- $K_i = 0.2$
- $K_d = 0.05$

## 9. 演習問題

### 問題1
1次遅れ系 $G(s) = \frac{1}{s+1}$ に対して、P制御、PI制御、PID制御をそれぞれ適用した場合の閉ループ伝達関数を求めよ。

### 問題2
Ziegler-Nicholsの限界感度法において、$K_u = 4.0$、$T_u = 2.0$ [s] が得られた。PID制御器のパラメータ $K_p$、$T_i$、$T_d$ を求めよ。

### 問題3
以下の状況でPIDパラメータをどのように調整すべきか説明せよ：
a) オーバーシュートが大きすぎる
b) 定常偏差が残る
c) 応答が遅すぎる

## 10. まとめ：PID制御の本質と実践

### 10.1 PID制御の本質的理解

**3つの時間軸への対応：**
- **P（比例）**：**現在**の偏差への即座の反応
- **I（積分）**：**過去**の偏差蓄積への継続的補正
- **D（微分）**：**未来**の変化への予測的制御

**人間の制御行動との類似性：**
- 直感的で理解しやすい
- 多くの制御問題に適用可能
- パラメータの物理的意味が明確

### 10.2 実践的な重要ポイント

**調整の基本原則：**
1. **安全第一**：システムを壊さない範囲で調整
2. **段階的アプローチ**：P→I→Dの順番で調整
3. **トレードオフの理解**：速応性 vs 安定性
4. **用途に応じた選択**：PI制御で十分な場合が多い

**よくある間違い：**
- D項を必ず使わなければならないという思い込み
- Ziegler-Nichols法への過度の依存
- ノイズ環境でのD項使用
- 積分飽和への無配慮

### 10.3 現代制御理論との関係

PID制御は古典制御の代表ですが：
- **現代制御理論の基礎**として重要
- **状態フィードバック制御**の特殊形
- **最適制御**の実用的近似として機能

### 10.4 今後の学習への橋渡し

次の学習ステップ：
- システムのモデリング（伝達関数、状態空間）
- 安定性解析（根軌跡、周波数応答）
- 現代制御理論（状態フィードバック、最適制御）
- 適応制御、ロバスト制御

PID制御の理解が、これらすべての基礎となります。

## 次回予告

次回は、**状態方程式の解**について学びます。線形システムの時間応答を解析的に求める方法を習得します。

## 参考文献

1. Karl J. Åström & Tore Hägglund, "PID Controllers: Theory, Design, and Tuning"
2. 須田信英『PID制御』朝倉書店
3. 足立修一『MATLABによる制御工学』東京電機大学出版局
