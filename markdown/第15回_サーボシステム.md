# 第15回：サーボシステム

## 学習目標
- サーボシステム（目標値追従制御）の原理を理解する
- 積分器を用いた定常偏差の除去方法を学ぶ
- 内部モデル原理を理解する

## 1. はじめに

これまで学んだ状態フィードバック制御やLQR制御は、主に**レギュレータ問題**（状態を原点に安定化）を扱ってきました。しかし、実用的な制御システムでは、時間とともに変化する**目標値（参照信号）**への追従が必要です。本講では、このような**サーボ問題**（servo problem）を扱います。

## 2. レギュレータ問題 vs サーボ問題

### 2.1 レギュレータ問題

**目的：** 状態を原点に安定化

$$\mathbf{u} = -\mathbf{K}\mathbf{x}$$

**特徴：**
- 目標値は常にゼロ
- 外乱に対して状態を原点に戻す

### 2.2 サーボ問題

**目的：** 出力を目標値に追従

$$\mathbf{y}(t) \to \mathbf{r}(t)$$

**特徴：**
- 目標値 $\mathbf{r}(t)$ は時間関数（ステップ、ランプ、正弦波など）
- 定常偏差をゼロにする必要がある

### 2.3 定常偏差の問題

単純な状態フィードバック：
$$\mathbf{u} = -\mathbf{K}(\mathbf{x} - \mathbf{x}_r)$$

では、一般に定常偏差が残ります。これは、システムに外乱やモデル誤差がある場合に顕著です。

## 3. 積分器による定常偏差の除去

### 3.1 PI制御の拡張

PID制御で学んだように、積分動作は定常偏差を除去します。この考え方を状態空間制御に適用します。

### 3.2 積分型サーボシステム

**拡大システム：**

偏差の積分を新たな状態変数として導入：

$$\mathbf{z}(t) = \int_0^t (\mathbf{r}(\tau) - \mathbf{y}(\tau)) d\tau$$

時間微分：
$$\dot{\mathbf{z}}(t) = \mathbf{r}(t) - \mathbf{y}(t) = \mathbf{r}(t) - \mathbf{C}\mathbf{x}(t)$$

**拡大された状態方程式：**

$$\begin{bmatrix} \dot{\mathbf{x}} \\ \dot{\mathbf{z}} \end{bmatrix} = \begin{bmatrix} \mathbf{A} & \mathbf{0} \\ -\mathbf{C} & \mathbf{0} \end{bmatrix}\begin{bmatrix} \mathbf{x} \\ \mathbf{z} \end{bmatrix} + \begin{bmatrix} \mathbf{B} \\ \mathbf{0} \end{bmatrix}\mathbf{u} + \begin{bmatrix} \mathbf{0} \\ \mathbf{I} \end{bmatrix}\mathbf{r}$$

**制御則：**

$$\mathbf{u} = -\mathbf{K}_x\mathbf{x} - \mathbf{K}_z\mathbf{z} = -\begin{bmatrix} \mathbf{K}_x & \mathbf{K}_z \end{bmatrix}\begin{bmatrix} \mathbf{x} \\ \mathbf{z} \end{bmatrix}$$

### 3.3 設計手順

**ステップ1：** 拡大システムを構成

**ステップ2：** 拡大システムに対して極配置またはLQRを適用

**ステップ3：** ゲイン $\mathbf{K}_x$, $\mathbf{K}_z$ を決定

**可制御性の条件：**

拡大システムが可制御であるための条件は、元のシステム $(\mathbf{A}, \mathbf{B})$ が可制御で、さらに：

$$\text{rank}\begin{bmatrix} \mathbf{A} & \mathbf{B} \\ \mathbf{C} & \mathbf{0} \end{bmatrix} = n + p$$

（$n$：状態の次数、$p$：出力の次数）

## 4. 内部モデル原理

### 4.1 原理の概要

**内部モデル原理（Internal Model Principle）：**

制御対象に作用する外乱や目標値のダイナミクスを、制御器内部にモデルとして組み込むことで、定常偏差をゼロにできる。

### 4.2 ステップ目標値の場合

ステップ入力は以下のダイナミクスで生成されます：

$$\dot{r}(t) = 0, \quad r(0) = r_0$$

これを制御器に組み込むには、積分器を追加します：

$$\dot{z} = r - y$$

これは、ステップ入力の「内部モデル」になっています。

### 4.3 ランプ目標値の場合

ランプ入力：$r(t) = at$

ダイナミクス：
$$\ddot{r}(t) = 0$$

**内部モデル：**

2重積分器を組み込みます：

$$\dot{\mathbf{z}} = \begin{bmatrix} 0 & 1 \\ 0 & 0 \end{bmatrix}\mathbf{z} + \begin{bmatrix} 0 \\ 1 \end{bmatrix}(r - y)$$

### 4.4 正弦波目標値の場合

正弦波入力：$r(t) = A\sin(\omega t)$

ダイナミクス：
$$\ddot{r}(t) + \omega^2 r(t) = 0$$

**内部モデル：**

$$\dot{\mathbf{z}} = \begin{bmatrix} 0 & \omega \\ -\omega & 0 \end{bmatrix}\mathbf{z} + \begin{bmatrix} 1 \\ 0 \end{bmatrix}(r - y)$$

## 5. 2自由度制御系

### 5.1 フィードフォワード制御

目標値に対する応答を改善するために、**フィードフォワード**項を追加します。

**制御則：**
$$\mathbf{u} = -\mathbf{K}\mathbf{x} + \mathbf{N}\mathbf{r}$$

ここで、$\mathbf{N}$ はフィードフォワードゲインです。

### 5.2 定常ゲインの計算

定常状態で：
$$\mathbf{x}_s = (\mathbf{I} - \mathbf{A} + \mathbf{B}\mathbf{K})^{-1}\mathbf{B}\mathbf{N}\mathbf{r}$$
$$\mathbf{y}_s = \mathbf{C}\mathbf{x}_s$$

$\mathbf{y}_s = \mathbf{r}$ となるように $\mathbf{N}$ を選びます：

$$\mathbf{N} = [\mathbf{C}(\mathbf{I} - \mathbf{A} + \mathbf{B}\mathbf{K})^{-1}\mathbf{B}]^{-1}$$

### 5.3 2自由度構造

**フィードバック部：** 外乱抑制と安定化
**フィードフォワード部：** 目標値追従性能の向上

これにより、2つの設計目標を独立に調整できます。

## 6. 外乱オブザーバ

### 6.1 外乱の推定

システムに作用する未知の外乱 $\mathbf{d}(t)$ を推定します：

$$\dot{\mathbf{x}} = \mathbf{A}\mathbf{x} + \mathbf{B}\mathbf{u} + \mathbf{E}\mathbf{d}$$

**拡大システム：**

外乱を状態の一部として扱います：

$$\begin{bmatrix} \dot{\mathbf{x}} \\ \dot{\mathbf{d}} \end{bmatrix} = \begin{bmatrix} \mathbf{A} & \mathbf{E} \\ \mathbf{0} & \mathbf{0} \end{bmatrix}\begin{bmatrix} \mathbf{x} \\ \mathbf{d} \end{bmatrix} + \begin{bmatrix} \mathbf{B} \\ \mathbf{0} \end{bmatrix}\mathbf{u}$$

**オブザーバで推定：**

拡大システムに対してオブザーバを設計し、$\hat{\mathbf{d}}$ を推定します。

### 6.2 外乱補償制御

推定した外乱を打ち消す制御：

$$\mathbf{u} = -\mathbf{K}\mathbf{x} - \mathbf{E}^{-1}\hat{\mathbf{d}}$$

（$\mathbf{E}$ が正則の場合）

これにより、外乱の影響を大幅に低減できます。

## 7. H∞制御とロバストサーボ

### 7.1 モデル誤差の影響

実際のシステムは、設計に用いたモデルと異なります（モデル化誤差）。

**ロバストサーボ問題：**

モデル誤差があっても、定常偏差をゼロに保つ制御系を設計する。

### 7.2 H∞制御の応用

H∞制御理論を用いることで、以下を同時に達成できます：
- 目標値追従性能
- 外乱抑制性能
- ロバスト安定性

## 8. 具体例

### 8.1 例題：モータ速度制御

**システム：**
$$\mathbf{A} = \begin{bmatrix} 0 & 1 \\ 0 & -b \end{bmatrix}, \quad \mathbf{B} = \begin{bmatrix} 0 \\ k \end{bmatrix}, \quad \mathbf{C} = \begin{bmatrix} 1 & 0 \end{bmatrix}$$

（$b$：減衰係数、$k$：モータゲイン）

**目標：** 速度指令 $r(t)$ に追従

**積分型サーボ：**

拡大システム：
$$\begin{bmatrix} \dot{x}_1 \\ \dot{x}_2 \\ \dot{z} \end{bmatrix} = \begin{bmatrix} 0 & 1 & 0 \\ 0 & -b & 0 \\ -1 & 0 & 0 \end{bmatrix}\begin{bmatrix} x_1 \\ x_2 \\ z \end{bmatrix} + \begin{bmatrix} 0 \\ k \\ 0 \end{bmatrix}u + \begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}r$$

**制御則：**
$$u = -\begin{bmatrix} K_1 & K_2 & K_z \end{bmatrix}\begin{bmatrix} x_1 \\ x_2 \\ z \end{bmatrix}$$

ゲインは極配置またはLQRで決定します。

### 8.2 シミュレーション結果

- ステップ目標値に対して定常偏差ゼロ
- 外乱が加わっても定常偏差なし
- 過渡応答は極配置/LQRで調整可能

## 9. 実装上の注意

### 9.1 積分飽和（Windup）

積分器は飽和しやすいため、アンチワインドアップ機構が必要です。

**対策：**
- 積分値の上下限設定
- 条件付き積分（誤差が大きいときは積分しない）
- バックカリキュレーション法

### 9.2 初期値の設定

積分器の初期値をゼロにすると、起動時に大きな過渡応答が生じる場合があります。

**対策：**
- 適切な初期値の設定
- バンプレス切替（制御モード切替時の衝撃を軽減）

## 10. 演習問題

### 問題1
以下のシステムに対して、積分型サーボシステムを設計せよ：
$$\mathbf{A} = \begin{bmatrix} 0 & 1 \\ -2 & -3 \end{bmatrix}, \quad \mathbf{B} = \begin{bmatrix} 0 \\ 1 \end{bmatrix}, \quad \mathbf{C} = \begin{bmatrix} 1 & 0 \end{bmatrix}$$

拡大システムの極を $\{-1, -2, -3\}$ に配置せよ。

### 問題2
ランプ目標値 $r(t) = t$ に追従するサーボシステムを設計せよ（2重積分器を用いる）。

### 問題3
内部モデル原理を用いて、正弦波外乱 $d(t) = \sin(2t)$ を完全に除去できることを示せ。

## 11. まとめ

- サーボシステムは目標値追従を実現
- 積分器により定常偏差をゼロに
- 内部モデル原理：外乱・目標値のダイナミクスを制御器に組み込む
- 2自由度制御系：フィードバックとフィードフォワードを分離
- 外乱オブザーバによる外乱推定と補償
- 実装ではアンチワインドアップが重要

## 次回予告

次回は、これまでの講義の**まとめ**を行い、現代制御理論の全体像を振り返ります。

## 参考文献

1. Bruce A. Francis & W. Murray Wonham, "The Internal Model Principle of Control Theory"
2. 児玉慎三・須田信英『システム制御理論入門』コロナ社
3. Karl J. Åström & Richard M. Murray, "Feedback Systems: An Introduction for Scientists and Engineers"
