<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬15å›: ã‚µãƒ¼ãƒœã‚·ã‚¹ãƒ†ãƒ </title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #27ae60; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        .theory-box { background: #e8f8f5; padding: 20px; border-left: 4px solid #27ae60; margin: 20px 0; border-radius: 5px; }
        .simulator { background: #f9f9f9; padding: 25px; border-radius: 8px; margin: 25px 0; border: 2px solid #ddd; }
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .control-group { display: flex; flex-direction: column; }
        label { font-weight: bold; color: #555; margin-bottom: 5px; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        button { background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #229954; }
        .plot-container { margin: 20px 0; }
        .matrix-display { background: white; padding: 15px; border-radius: 5px; font-family: monospace; margin: 10px 0; border: 1px solid #ddd; white-space: pre-wrap; }
        .example { background: #fff9e6; padding: 15px; border-left: 4px solid #f39c12; margin: 20px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ç¬¬15å›: ã‚µãƒ¼ãƒœã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <div class="theory-box">
            <h2>ğŸ“š ç†è«–ã®æ¦‚è¦</h2>
            <p><strong>ã‚µãƒ¼ãƒœã‚·ã‚¹ãƒ†ãƒ ï¼ˆServo Systemï¼‰</strong>ã¯ã€ç›®æ¨™å€¤ã«è¿½å¾“ã—ã€å®šå¸¸åå·®ã‚’ã‚¼ãƒ­ã«ã™ã‚‹åˆ¶å¾¡ç³»ã§ã™ã€‚ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿å•é¡Œã‚’æ‹¡å¼µã—ãŸã‚‚ã®ã§ã™ã€‚</p>
            
            <h3>ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ vs ã‚µãƒ¼ãƒœ</h3>
            <ul>
                <li><strong>ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿</strong>: çŠ¶æ…‹ã‚’åŸç‚¹ï¼ˆã‚¼ãƒ­ï¼‰ã«å®‰å®šåŒ– â†’ \( x \to 0 \)</li>
                <li><strong>ã‚µãƒ¼ãƒœ</strong>: å‡ºåŠ›ã‚’ç›®æ¨™å€¤ã«è¿½å¾“ â†’ \( y \to r \)ï¼ˆç›®æ¨™å€¤ rï¼‰</li>
            </ul>
            
            <h3>ç©åˆ†å™¨ã‚’ç”¨ã„ãŸã‚µãƒ¼ãƒœç³»</h3>
            <p>å®šå¸¸åå·®ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ãŸã‚ã€èª¤å·®ã®ç©åˆ†ã‚’çŠ¶æ…‹ã«è¿½åŠ :</p>
            <p>$$\dot{z} = r - y = r - Cx$$</p>
            <p>æ‹¡å¤§ç³»ã®çŠ¶æ…‹æ–¹ç¨‹å¼:</p>
            <p>$$\begin{bmatrix} \dot{x} \\ \dot{z} \end{bmatrix} = \begin{bmatrix} A & 0 \\ -C & 0 \end{bmatrix} \begin{bmatrix} x \\ z \end{bmatrix} + \begin{bmatrix} B \\ 0 \end{bmatrix} u + \begin{bmatrix} 0 \\ 1 \end{bmatrix} r$$</p>
            
            <h3>æœ€é©ã‚µãƒ¼ãƒœç³»ï¼ˆLQI: Linear Quadratic Integralï¼‰</h3>
            <p>æ‹¡å¤§ç³»ã«å¯¾ã—ã¦LQRã‚’é©ç”¨ã™ã‚‹ã“ã¨ã§æœ€é©ã‚µãƒ¼ãƒœç³»ã‚’è¨­è¨ˆ:</p>
            <p>$$u = -K_x x - K_z z$$</p>
            
            <h3>å†…éƒ¨ãƒ¢ãƒ‡ãƒ«åŸç†</h3>
            <p>å¤–ä¹±ã‚„ç›®æ¨™å€¤ã®ç‰¹æ€§ï¼ˆä¾‹: ã‚¹ãƒ†ãƒƒãƒ—ã€ãƒ©ãƒ³ãƒ—ã€æ­£å¼¦æ³¢ï¼‰ã‚’åˆ¶å¾¡å™¨å†…éƒ¨ã§ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚‹ã“ã¨ã§ã€ãã®ä¿¡å·ã«å¯¾ã™ã‚‹å®šå¸¸åå·®ã‚’ã‚¼ãƒ­ã«ã§ãã¾ã™ã€‚</p>
        </div>

        <div class="simulator">
            <h2>ğŸ® ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼: ã‚µãƒ¼ãƒœç³»è¨­è¨ˆ</h2>
            
            <div class="controls">
                <div class="control-group">
                    <label>ã‚·ã‚¹ãƒ†ãƒ é¸æŠ:</label>
                    <select id="systemType">
                        <option value="custom">ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›</option>
                        <option value="motor">DCãƒ¢ãƒ¼ã‚¿</option>
                        <option value="mass">è³ªç‚¹ç³»</option>
                    </select>
                </div>
            </div>
            
            <h3>ã‚·ã‚¹ãƒ†ãƒ è¡Œåˆ—å…¥åŠ›ï¼ˆ2Ã—2ï¼‰</h3>
            <div class="controls">
                <div class="control-group">
                    <label>A[0,0]:</label>
                    <input type="number" id="a00" value="0" step="0.1">
                </div>
                <div class="control-group">
                    <label>A[0,1]:</label>
                    <input type="number" id="a01" value="1" step="0.1">
                </div>
                <div class="control-group">
                    <label>A[1,0]:</label>
                    <input type="number" id="a10" value="0" step="0.1">
                </div>
                <div class="control-group">
                    <label>A[1,1]:</label>
                    <input type="number" id="a11" value="-0.5" step="0.1">
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>B[0]:</label>
                    <input type="number" id="b0" value="0" step="0.1">
                </div>
                <div class="control-group">
                    <label>B[1]:</label>
                    <input type="number" id="b1" value="1" step="0.1">
                </div>
                <div class="control-group">
                    <label>C[0]:</label>
                    <input type="number" id="c0" value="1" step="0.1">
                </div>
                <div class="control-group">
                    <label>C[1]:</label>
                    <input type="number" id="c1" value="0" step="0.1">
                </div>
            </div>
            
            <h3>åˆ¶å¾¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
            <div class="controls">
                <div class="control-group">
                    <label>Kâ‚“[0] (çŠ¶æ…‹FB):</label>
                    <input type="number" id="kx0" value="2" step="0.1">
                </div>
                <div class="control-group">
                    <label>Kâ‚“[1] (çŠ¶æ…‹FB):</label>
                    <input type="number" id="kx1" value="3" step="0.1">
                </div>
                <div class="control-group">
                    <label>Kz (ç©åˆ†ã‚²ã‚¤ãƒ³):</label>
                    <input type="number" id="kz" value="1" step="0.1">
                </div>
            </div>
            
            <h3>ç›®æ¨™å€¤è¨­å®š</h3>
            <div class="controls">
                <div class="control-group">
                    <label>ç›®æ¨™å€¤ r:</label>
                    <input type="number" id="reference" value="1" step="0.1">
                </div>
            </div>
            
            <button onclick="simulateServo()">ğŸ“ˆ ã‚µãƒ¼ãƒœå¿œç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            <button onclick="compareRegulatorServo()">ğŸ”„ ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ã¨æ¯”è¼ƒ</button>
            
            <div id="servoPlot" class="plot-container"></div>
            <div id="comparisonPlot" class="plot-container"></div>
        </div>

        <div class="example">
            <h3>ğŸ’¡ å®Ÿä¾‹: ãƒ¢ãƒ¼ã‚¿ä½ç½®åˆ¶å¾¡ã‚µãƒ¼ãƒœ</h3>
            <p><strong>å•é¡Œ</strong>: DCãƒ¢ãƒ¼ã‚¿ã®ä½ç½®ã‚’ç›®æ¨™è§’åº¦ã«è¿½å¾“ã•ã›ã‚‹ã‚µãƒ¼ãƒœç³»ã‚’è¨­è¨ˆã›ã‚ˆã€‚</p>
            <p><strong>è§£ç­”</strong>:</p>
            <p>ãƒ¢ãƒ¼ã‚¿ã®çŠ¶æ…‹æ–¹ç¨‹å¼ï¼ˆè§’åº¦ Î¸ã€è§’é€Ÿåº¦ Ï‰ï¼‰:</p>
            <p>$$\begin{bmatrix} \dot{\theta} \\ \dot{\omega} \end{bmatrix} = \begin{bmatrix} 0 & 1 \\ 0 & -b/J \end{bmatrix} \begin{bmatrix} \theta \\ \omega \end{bmatrix} + \begin{bmatrix} 0 \\ K/J \end{bmatrix} u$$</p>
            <p>å‡ºåŠ›: \( y = \theta \)</p>
            <p>ç©åˆ†çŠ¶æ…‹ \( z = \int (r - \theta) dt \) ã‚’è¿½åŠ ã—ã€æ‹¡å¤§ç³»ã«å¯¾ã—ã¦LQRã‚’é©ç”¨ã€‚</p>
            <p>çµæœ: å®šå¸¸åå·®ã‚¼ãƒ­ã§ç›®æ¨™è§’åº¦ã«è¿½å¾“ã™ã‚‹ã‚µãƒ¼ãƒœç³»ãŒå®Ÿç¾ã•ã‚Œã‚‹ã€‚</p>
        </div>

        <div class="theory-box">
            <h2>ğŸ¯ é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h2>
            <ul>
                <li>ã‚µãƒ¼ãƒœç³»ã¯ç©åˆ†å™¨ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å®šå¸¸åå·®ã‚’ã‚¼ãƒ­ã«ã™ã‚‹</li>
                <li>LQIï¼ˆLQRã«ç©åˆ†å‹•ä½œã‚’è¿½åŠ ï¼‰ã§æœ€é©ã‚µãƒ¼ãƒœç³»ã‚’è¨­è¨ˆå¯èƒ½</li>
                <li>å†…éƒ¨ãƒ¢ãƒ‡ãƒ«åŸç†: å¤–ä¹±ãƒ»ç›®æ¨™å€¤ã®ç‰¹æ€§ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚Œã°è¿½å¾“å¯èƒ½</li>
                <li>ç©åˆ†å‹•ä½œã¯ä½å‘¨æ³¢å¤–ä¹±æŠ‘åˆ¶ã«æœ‰åŠ¹ã ãŒã€å®‰å®šæ€§ã«æ³¨æ„</li>
                <li>å®Ÿã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã‚¢ãƒ³ãƒãƒ¯ã‚¤ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—å¯¾ç­–ãŒå¿…è¦</li>
            </ul>
        </div>
    </div>

    <script>
        function getSystem() {
            const A = [
                [parseFloat(document.getElementById('a00').value), parseFloat(document.getElementById('a01').value)],
                [parseFloat(document.getElementById('a10').value), parseFloat(document.getElementById('a11').value)]
            ];
            const B = [parseFloat(document.getElementById('b0').value), parseFloat(document.getElementById('b1').value)];
            const C = [parseFloat(document.getElementById('c0').value), parseFloat(document.getElementById('c1').value)];
            const Kx = [parseFloat(document.getElementById('kx0').value), parseFloat(document.getElementById('kx1').value)];
            const Kz = parseFloat(document.getElementById('kz').value);
            const r = parseFloat(document.getElementById('reference').value);
            return { A, B, C, Kx, Kz, r };
        }

        function simulateServo() {
            const { A, B, C, Kx, Kz, r } = getSystem();
            
            const dt = 0.01;
            const tMax = 10;
            const steps = Math.floor(tMax / dt);
            
            let x = [0, 0];  // çŠ¶æ…‹
            let z = 0;       // ç©åˆ†çŠ¶æ…‹
            
            const t = [];
            const y_arr = [];
            const r_arr = [];
            const u_arr = [];
            const e_arr = [];
            
            for (let i = 0; i <= steps; i++) {
                t.push(i * dt);
                
                const y = C[0] * x[0] + C[1] * x[1];
                const e = r - y;
                
                // åˆ¶å¾¡å…¥åŠ›: u = -Kx*x - Kz*z
                const u = -(Kx[0] * x[0] + Kx[1] * x[1] + Kz * z);
                
                // çŠ¶æ…‹æ›´æ–°
                const dx = [
                    A[0][0] * x[0] + A[0][1] * x[1] + B[0] * u,
                    A[1][0] * x[0] + A[1][1] * x[1] + B[1] * u
                ];
                x[0] += dx[0] * dt;
                x[1] += dx[1] * dt;
                
                // ç©åˆ†çŠ¶æ…‹æ›´æ–°
                z += e * dt;
                
                y_arr.push(y);
                r_arr.push(r);
                u_arr.push(u);
                e_arr.push(e);
            }
            
            const traces = [
                {
                    x: t,
                    y: r_arr,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'ç›®æ¨™å€¤ r',
                    line: { color: '#95a5a6', width: 2, dash: 'dash' }
                },
                {
                    x: t,
                    y: y_arr,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'å‡ºåŠ› y',
                    line: { color: '#27ae60', width: 2 }
                },
                {
                    x: t,
                    y: e_arr,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'èª¤å·® e = r - y',
                    line: { color: '#e74c3c', width: 2 },
                    yaxis: 'y2'
                }
            ];
            
            const layout = {
                title: 'ã‚µãƒ¼ãƒœç³»ã®å¿œç­”',
                xaxis: { title: 'æ™‚é–“ [s]' },
                yaxis: { title: 'å‡ºåŠ› y', side: 'left' },
                yaxis2: { title: 'èª¤å·® e', side: 'right', overlaying: 'y' },
                hovermode: 'x'
            };
            
            Plotly.newPlot('servoPlot', traces, layout);
        }

        function compareRegulatorServo() {
            const { A, B, C, Kx, Kz, r } = getSystem();
            
            const dt = 0.01;
            const tMax = 10;
            const steps = Math.floor(tMax / dt);
            
            // ã‚µãƒ¼ãƒœç³»
            let x_servo = [0, 0];
            let z_servo = 0;
            const y_servo = [];
            
            // ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆç©åˆ†ãªã—ï¼‰
            let x_reg = [0, 0];
            const y_reg = [];
            
            const t = [];
            
            for (let i = 0; i <= steps; i++) {
                t.push(i * dt);
                
                // ã‚µãƒ¼ãƒœç³»
                const y_s = C[0] * x_servo[0] + C[1] * x_servo[1];
                const e_s = r - y_s;
                const u_s = -(Kx[0] * x_servo[0] + Kx[1] * x_servo[1] + Kz * z_servo);
                
                const dx_s = [
                    A[0][0] * x_servo[0] + A[0][1] * x_servo[1] + B[0] * u_s,
                    A[1][0] * x_servo[0] + A[1][1] * x_servo[1] + B[1] * u_s
                ];
                x_servo[0] += dx_s[0] * dt;
                x_servo[1] += dx_s[1] * dt;
                z_servo += e_s * dt;
                y_servo.push(y_s);
                
                // ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆç›®æ¨™å€¤ã‚’ç›´æ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ï¼‰
                const y_r = C[0] * x_reg[0] + C[1] * x_reg[1];
                const u_r = -(Kx[0] * x_reg[0] + Kx[1] * x_reg[1]) + r; // ç°¡æ˜“FF
                
                const dx_r = [
                    A[0][0] * x_reg[0] + A[0][1] * x_reg[1] + B[0] * u_r,
                    A[1][0] * x_reg[0] + A[1][1] * x_reg[1] + B[1] * u_r
                ];
                x_reg[0] += dx_r[0] * dt;
                x_reg[1] += dx_r[1] * dt;
                y_reg.push(y_r);
            }
            
            const traces = [
                {
                    x: t,
                    y: Array(t.length).fill(r),
                    type: 'scatter',
                    mode: 'lines',
                    name: 'ç›®æ¨™å€¤',
                    line: { color: '#95a5a6', width: 2, dash: 'dash' }
                },
                {
                    x: t,
                    y: y_servo,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'ã‚µãƒ¼ãƒœç³»ï¼ˆç©åˆ†ã‚ã‚Šï¼‰',
                    line: { color: '#27ae60', width: 2 }
                },
                {
                    x: t,
                    y: y_reg,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆç©åˆ†ãªã—ï¼‰',
                    line: { color: '#e74c3c', width: 2, dash: 'dot' }
                }
            ];
            
            const layout = {
                title: 'ã‚µãƒ¼ãƒœç³» vs ãƒ¬ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚¿ã®æ¯”è¼ƒ',
                xaxis: { title: 'æ™‚é–“ [s]' },
                yaxis: { title: 'å‡ºåŠ›' },
                hovermode: 'x'
            };
            
            Plotly.newPlot('comparisonPlot', traces, layout);
        }

        document.getElementById('systemType').addEventListener('change', function() {
            const type = this.value;
            if (type === 'motor') {
                document.getElementById('a00').value = '0';
                document.getElementById('a01').value = '1';
                document.getElementById('a10').value = '0';
                document.getElementById('a11').value = '-0.5';
                document.getElementById('b0').value = '0';
                document.getElementById('b1').value = '2';
                document.getElementById('c0').value = '1';
                document.getElementById('c1').value = '0';
            } else if (type === 'mass') {
                document.getElementById('a00').value = '0';
                document.getElementById('a01').value = '1';
                document.getElementById('a10').value = '0';
                document.getElementById('a11').value = '0';
                document.getElementById('b0').value = '0';
                document.getElementById('b1').value = '1';
                document.getElementById('c0').value = '1';
                document.getElementById('c1').value = '0';
            }
        });
    </script>
</body>
</html>
