<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2å›ï¼šPIDåˆ¶å¾¡</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .content {
            padding: 40px;
        }
        h2 {
            color: #f5576c;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #f5576c;
        }
        h3 {
            color: #f093fb;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        .highlight-box {
            background: #fff0f5;
            border-left: 5px solid #f5576c;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .interactive-demo {
            background: #f0f8ff;
            border: 2px solid #4169e1;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
        }
        .pid-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .control-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .control-box h4 {
            margin-bottom: 10px;
            color: #333;
        }
        button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        .slider-container {
            margin: 15px 0;
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        canvas {
            border: 2px solid #ddd;
            border-radius: 5px;
            display: block;
            margin: 20px auto;
            background: white;
        }
        .value-display {
            font-family: 'Courier New', monospace;
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background: #f093fb;
            color: white;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .formula {
            background: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            overflow-x: auto;
        }
        ul {
            margin-left: 30px;
            margin-top: 10px;
        }
        li {
            margin: 8px 0;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        .info-card {
            background: #fff;
            border: 2px solid #f093fb;
            border-radius: 8px;
            padding: 15px;
        }
        .info-card h4 {
            color: #f5576c;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›ï¸ ç¬¬2å›ï¼šPIDåˆ¶å¾¡</h1>
            <p class="subtitle">Proportional-Integral-Derivative Control</p>
        </header>
        
        <div class="content">
            <div class="highlight-box">
                <h3>ğŸ¯ å­¦ç¿’ç›®æ¨™</h3>
                <ul>
                    <li>PIDåˆ¶å¾¡ã®åŸºæœ¬åŸç†ã¨å„è¦ç´ ã®å½¹å‰²ã‚’ç†è§£ã™ã‚‹</li>
                    <li>æ¯”ä¾‹ï¼ˆPï¼‰ã€ç©åˆ†ï¼ˆIï¼‰ã€å¾®åˆ†ï¼ˆDï¼‰å‹•ä½œã®ç‰¹æ€§ã‚’æŠŠæ¡ã™ã‚‹</li>
                    <li>PIDãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¿æ•´æ–¹æ³•ã‚’å­¦ã¶</li>
                </ul>
            </div>

            <h2>1. PIDåˆ¶å¾¡ã®åŸºæœ¬æ§‹é€ </h2>
            
            <div class="formula">
                <h3>PIDåˆ¶å¾¡å‰‡</h3>
                <p>$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$</p>
                <p>å„é …ã®æ„å‘³ï¼š</p>
                <ul>
                    <li>\(u_P(t) = K_p e(t)\)ï¼šæ¯”ä¾‹å‹•ä½œï¼ˆPå‹•ä½œï¼‰</li>
                    <li>\(u_I(t) = K_i \int_0^t e(\tau) d\tau\)ï¼šç©åˆ†å‹•ä½œï¼ˆIå‹•ä½œï¼‰</li>
                    <li>\(u_D(t) = K_d \frac{de(t)}{dt}\)ï¼šå¾®åˆ†å‹•ä½œï¼ˆDå‹•ä½œï¼‰</li>
                </ul>
            </div>

            <h2>2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–PIDã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</h2>
            
            <div class="interactive-demo">
                <h3>ğŸ”§ PIDãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´</h3>
                
                <div class="pid-controls">
                    <div class="control-box">
                        <h4>æ¯”ä¾‹ã‚²ã‚¤ãƒ³ (Kp)</h4>
                        <input type="range" id="kp-slider" min="0" max="5" step="0.1" value="1">
                        <div style="text-align: center;">
                            <strong id="kp-value">1.0</strong>
                        </div>
                    </div>
                    
                    <div class="control-box">
                        <h4>ç©åˆ†ã‚²ã‚¤ãƒ³ (Ki)</h4>
                        <input type="range" id="ki-slider" min="0" max="2" step="0.05" value="0.5">
                        <div style="text-align: center;">
                            <strong id="ki-value">0.5</strong>
                        </div>
                    </div>
                    
                    <div class="control-box">
                        <h4>å¾®åˆ†ã‚²ã‚¤ãƒ³ (Kd)</h4>
                        <input type="range" id="kd-slider" min="0" max="2" step="0.05" value="0.2">
                        <div style="text-align: center;">
                            <strong id="kd-value">0.2</strong>
                        </div>
                    </div>
                </div>

                <div class="slider-container">
                    <label><strong>ç›®æ¨™å€¤:</strong> <span id="setpoint-value">1.0</span></label>
                    <input type="range" id="setpoint-slider" min="0.5" max="2" step="0.1" value="1">
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button onclick="runPIDSimulation()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
                    <button onclick="resetPID()">ãƒªã‚»ãƒƒãƒˆ</button>
                    <button onclick="loadPreset('p')">Påˆ¶å¾¡ã®ã¿</button>
                    <button onclick="loadPreset('pi')">PIåˆ¶å¾¡</button>
                    <button onclick="loadPreset('pid')">PIDåˆ¶å¾¡</button>
                </div>
                
                <canvas id="pid-canvas" width="900" height="400"></canvas>
                
                <div class="value-display">
                    <div id="performance-metrics"></div>
                </div>
            </div>

            <h2>3. å„å‹•ä½œã®ç‰¹æ€§æ¯”è¼ƒ</h2>
            
            <div class="info-grid">
                <div class="info-card">
                    <h4>âš¡ æ¯”ä¾‹å‹•ä½œï¼ˆPå‹•ä½œï¼‰</h4>
                    <ul style="margin-left: 20px; font-size: 0.9em;">
                        <li>å¿œç­”ãŒé€Ÿã„</li>
                        <li>å®Ÿè£…ãŒç°¡å˜</li>
                        <li>æ®‹ç•™åå·®ãŒæ®‹ã‚‹</li>
                        <li>ã‚²ã‚¤ãƒ³å¤§â†’æŒ¯å‹•çš„</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h4>âˆ« ç©åˆ†å‹•ä½œï¼ˆIå‹•ä½œï¼‰</h4>
                    <ul style="margin-left: 20px; font-size: 0.9em;">
                        <li>å®šå¸¸åå·®ã‚’é™¤å»</li>
                        <li>å¿œç­”ãŒé…ããªã‚‹</li>
                        <li>ç©åˆ†é£½å’Œã«æ³¨æ„</li>
                        <li>å®‰å®šæ€§ä½ä¸‹ã®æã‚Œ</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h4>d/dt å¾®åˆ†å‹•ä½œï¼ˆDå‹•ä½œï¼‰</h4>
                    <ul style="margin-left: 20px; font-size: 0.9em;">
                        <li>äºˆæ¸¬çš„åˆ¶å¾¡</li>
                        <li>ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆæŠ‘åˆ¶</li>
                        <li>ãƒã‚¤ã‚ºã«æ•æ„Ÿ</li>
                        <li>å®‰å®šæ€§å‘ä¸Š</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h4>ğŸ¯ PIDçµ±åˆ</h4>
                    <ul style="margin-left: 20px; font-size: 0.9em;">
                        <li>å„å‹•ä½œã®é•·æ‰€ã‚’æ´»ç”¨</li>
                        <li>é«˜æ€§èƒ½ãªåˆ¶å¾¡</li>
                        <li>èª¿æ•´ãŒå¿…è¦</li>
                        <li>ç”£æ¥­ç•Œã§æ¨™æº–çš„</li>
                    </ul>
                </div>
            </div>

            <h2>4. Ziegler-Nicholsèª¿æ•´æ³•</h2>
            
            <h3>é™ç•Œæ„Ÿåº¦æ³•</h3>
            <table>
                <tr>
                    <th>åˆ¶å¾¡å™¨ã‚¿ã‚¤ãƒ—</th>
                    <th>Kp</th>
                    <th>Ti</th>
                    <th>Td</th>
                </tr>
                <tr>
                    <td>P</td>
                    <td>0.5 Ku</td>
                    <td>âˆ</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>PI</td>
                    <td>0.45 Ku</td>
                    <td>Tu/1.2</td>
                    <td>0</td>
                </tr>
                <tr>
                    <td>PID</td>
                    <td>0.6 Ku</td>
                    <td>Tu/2</td>
                    <td>Tu/8</td>
                </tr>
            </table>

            <h3>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã®å½±éŸ¿</h3>
            <table>
                <tr>
                    <th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¢—åŠ </th>
                    <th>ç«‹ã¡ä¸ŠãŒã‚Šæ™‚é–“</th>
                    <th>ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆ</th>
                    <th>æ•´å®šæ™‚é–“</th>
                    <th>å®šå¸¸åå·®</th>
                </tr>
                <tr>
                    <td>Kp</td>
                    <td>â†“ æ¸›å°‘</td>
                    <td>â†‘ å¢—åŠ </td>
                    <td>å°å¤‰åŒ–</td>
                    <td>â†“ æ¸›å°‘</td>
                </tr>
                <tr>
                    <td>Ki</td>
                    <td>â†“ æ¸›å°‘</td>
                    <td>â†‘ å¢—åŠ </td>
                    <td>â†‘ å¢—åŠ </td>
                    <td>â˜… é™¤å»</td>
                </tr>
                <tr>
                    <td>Kd</td>
                    <td>å°å¤‰åŒ–</td>
                    <td>â†“ æ¸›å°‘</td>
                    <td>â†“ æ¸›å°‘</td>
                    <td>å°å¤‰åŒ–</td>
                </tr>
            </table>

            <h2>5. å®Ÿè£…ä¸Šã®å•é¡Œã¨å¯¾ç­–</h2>
            
            <div class="interactive-demo">
                <h3>ğŸ’¡ ç©åˆ†é£½å’Œï¼ˆIntegral Windupï¼‰ãƒ‡ãƒ¢</h3>
                <p>å¤§ããªåå·®ãŒé•·æ™‚é–“ç¶šãã¨ç©åˆ†é …ãŒéå¤§ã«è“„ç©ã—ã€å¤§ããªã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button onclick="demonstrateWindup(false)">é€šå¸¸ã®PIåˆ¶å¾¡</button>
                    <button onclick="demonstrateWindup(true)">ã‚¢ãƒ³ãƒãƒ¯ã‚¤ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—ä»˜ã</button>
                </div>
                
                <canvas id="windup-canvas" width="900" height="300"></canvas>
            </div>

            <div class="highlight-box">
                <h3>ğŸ›¡ï¸ ä¸»ãªå¯¾ç­–</h3>
                <ul>
                    <li><strong>ç©åˆ†é£½å’Œå¯¾ç­–:</strong> ã‚¢ãƒ³ãƒãƒ¯ã‚¤ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—æ©Ÿæ§‹ã€ç©åˆ†é …ã®ä¸Šä¸‹é™è¨­å®š</li>
                    <li><strong>å¾®åˆ†ã‚­ãƒƒã‚¯å¯¾ç­–:</strong> å‡ºåŠ›ã®å¾®åˆ†ã‚’ä½¿ç”¨ã€å¾®åˆ†ãƒ•ã‚£ãƒ«ã‚¿ã®å°å…¥</li>
                    <li><strong>ãƒã‚¤ã‚ºå¯¾ç­–:</strong> ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã€ä¸å®Œå…¨å¾®åˆ†ã®ä½¿ç”¨</li>
                </ul>
            </div>

            <h2>6. ã¾ã¨ã‚</h2>
            <div class="highlight-box">
                <ul>
                    <li>PIDåˆ¶å¾¡ã¯3ã¤ã®åŸºæœ¬å‹•ä½œï¼ˆP, I, Dï¼‰ã®çµ„ã¿åˆã‚ã›</li>
                    <li>På‹•ä½œï¼šå¿œç­”ã®é€Ÿã•ã€Iå‹•ä½œï¼šå®šå¸¸åå·®ã®é™¤å»ã€Då‹•ä½œï¼šå®‰å®šæ€§ã®å‘ä¸Š</li>
                    <li>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã«ã¯Ziegler-Nicholsæ³•ãªã©ã®ä½“ç³»çš„æ‰‹æ³•ãŒã‚ã‚‹</li>
                    <li>ç©åˆ†é£½å’Œã‚„å¾®åˆ†ã‚­ãƒƒã‚¯ãªã©ã®å•é¡Œã«å¯¾ã™ã‚‹å¯¾ç­–ãŒé‡è¦</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’è¡¨ç¤ºæ›´æ–°
        document.getElementById('kp-slider').addEventListener('input', function() {
            document.getElementById('kp-value').textContent = this.value;
        });
        
        document.getElementById('ki-slider').addEventListener('input', function() {
            document.getElementById('ki-value').textContent = this.value;
        });
        
        document.getElementById('kd-slider').addEventListener('input', function() {
            document.getElementById('kd-value').textContent = this.value;
        });

        document.getElementById('setpoint-slider').addEventListener('input', function() {
            document.getElementById('setpoint-value').textContent = this.value;
        });

        function runPIDSimulation() {
            const canvas = document.getElementById('pid-canvas');
            const ctx = canvas.getContext('2d');
            
            const Kp = parseFloat(document.getElementById('kp-slider').value);
            const Ki = parseFloat(document.getElementById('ki-slider').value);
            const Kd = parseFloat(document.getElementById('kd-slider').value);
            const setpoint = parseFloat(document.getElementById('setpoint-slider').value);
            
            // ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è»¸ã®æç”»
            drawAxes(ctx, canvas.width, canvas.height);
            
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            const dt = 0.01;
            const tMax = 10;
            const steps = tMax / dt;
            
            // ã‚·ã‚¹ãƒ†ãƒ : 1æ¬¡é…ã‚Œç³» G(s) = 1/(s+1)
            let y = 0;       // å‡ºåŠ›
            let integral = 0; // ç©åˆ†é …
            let prevError = 0; // å‰å›ã®åå·®
            
            const scaleX = (canvas.width - 100) / tMax;
            const scaleY = 150;
            const offsetY = canvas.height - 80;
            
            // å¿œç­”ã®æç”»
            ctx.strokeStyle = '#f5576c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let maxOvershoot = 0;
            let settlingTime = 0;
            let steadyStateError = 0;
            
            for (let i = 0; i < steps; i++) {
                const t = i * dt;
                const x = 50 + t * scaleX;
                const yPixel = offsetY - y * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(x, yPixel);
                } else {
                    ctx.lineTo(x, yPixel);
                }
                
                // PIDåˆ¶å¾¡
                const error = setpoint - y;
                integral += error * dt;
                const derivative = (error - prevError) / dt;
                
                const u = Kp * error + Ki * integral + Kd * derivative;
                
                // ã‚·ã‚¹ãƒ†ãƒ å¿œç­”ï¼ˆ1æ¬¡é…ã‚Œï¼‰
                const dydt = -y + u;
                y += dydt * dt;
                
                prevError = error;
                
                // æ€§èƒ½æŒ‡æ¨™ã®è¨ˆç®—
                if (y > maxOvershoot) maxOvershoot = y;
                if (Math.abs(error) > 0.02 * setpoint) {
                    settlingTime = t;
                }
                if (i === steps - 1) {
                    steadyStateError = Math.abs(error);
                }
            }
            
            ctx.stroke();
            
            // ç›®æ¨™å€¤ã®ãƒ©ã‚¤ãƒ³
            ctx.strokeStyle = '#4169e1';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(50, offsetY - setpoint * scaleY);
            ctx.lineTo(canvas.width - 50, offsetY - setpoint * scaleY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('æ™‚é–“ (s)', canvas.width - 70, offsetY + 40);
            ctx.fillText('å‡ºåŠ›', 10, 30);
            
            // æ€§èƒ½æŒ‡æ¨™ã®è¡¨ç¤º
            const overshoot = ((maxOvershoot - setpoint) / setpoint * 100).toFixed(1);
            const metrics = `
æ€§èƒ½æŒ‡æ¨™:
  ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆ: ${overshoot}%
  æ•´å®šæ™‚é–“: ${settlingTime.toFixed(2)} s
  å®šå¸¸åå·®: ${steadyStateError.toFixed(4)}
  
PIDãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:
  Kp = ${Kp}, Ki = ${Ki}, Kd = ${Kd}
            `;
            document.getElementById('performance-metrics').textContent = metrics;
        }

        function drawAxes(ctx, width, height) {
            const offsetY = height - 80;
            
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(50, offsetY);
            ctx.lineTo(width - 50, offsetY);
            ctx.stroke();
            
            // ç›®ç››ã‚Š
            for (let i = 0; i <= 10; i++) {
                const x = 50 + i * (width - 100) / 10;
                ctx.beginPath();
                ctx.moveTo(x, offsetY);
                ctx.lineTo(x, offsetY + 5);
                ctx.stroke();
                
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(i.toString(), x, offsetY + 20);
            }
        }

        function resetPID() {
            document.getElementById('kp-slider').value = 1;
            document.getElementById('ki-slider').value = 0.5;
            document.getElementById('kd-slider').value = 0.2;
            document.getElementById('setpoint-slider').value = 1;
            
            document.getElementById('kp-value').textContent = '1.0';
            document.getElementById('ki-value').textContent = '0.5';
            document.getElementById('kd-value').textContent = '0.2';
            document.getElementById('setpoint-value').textContent = '1.0';
            
            runPIDSimulation();
        }

        function loadPreset(type) {
            if (type === 'p') {
                document.getElementById('kp-slider').value = 2;
                document.getElementById('ki-slider').value = 0;
                document.getElementById('kd-slider').value = 0;
                document.getElementById('kp-value').textContent = '2.0';
                document.getElementById('ki-value').textContent = '0.0';
                document.getElementById('kd-value').textContent = '0.0';
            } else if (type === 'pi') {
                document.getElementById('kp-slider').value = 1.8;
                document.getElementById('ki-slider').value = 0.9;
                document.getElementById('kd-slider').value = 0;
                document.getElementById('kp-value').textContent = '1.8';
                document.getElementById('ki-value').textContent = '0.9';
                document.getElementById('kd-value').textContent = '0.0';
            } else if (type === 'pid') {
                document.getElementById('kp-slider').value = 2.4;
                document.getElementById('ki-slider').value = 1.0;
                document.getElementById('kd-slider').value = 0.25;
                document.getElementById('kp-value').textContent = '2.4';
                document.getElementById('ki-value').textContent = '1.0';
                document.getElementById('kd-value').textContent = '0.25';
            }
            runPIDSimulation();
        }

        function demonstrateWindup(antiWindup) {
            const canvas = document.getElementById('windup-canvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const offsetY = canvas.height - 60;
            drawAxes2(ctx, canvas.width, canvas.height, offsetY);
            
            const dt = 0.01;
            const tMax = 10;
            const steps = tMax / dt;
            
            let y = 0;
            let integral = 0;
            let u = 0;
            const Kp = 1.5;
            const Ki = 0.8;
            const uMax = 5; // é£½å’Œé™ç•Œ
            
            const scaleX = (canvas.width - 100) / tMax;
            const scaleY = 40;
            
            ctx.strokeStyle = antiWindup ? '#4caf50' : '#f5576c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i < steps; i++) {
                const t = i * dt;
                const x = 50 + t * scaleX;
                const yPixel = offsetY - y * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(x, yPixel);
                } else {
                    ctx.lineTo(x, yPixel);
                }
                
                // ç›®æ¨™å€¤ã‚’ã‚¹ãƒ†ãƒƒãƒ—çŠ¶ã«å¤‰åŒ–
                const setpoint = t < 2 ? 0 : (t < 6 ? 2 : 1);
                const error = setpoint - y;
                
                // PIåˆ¶å¾¡
                if (!antiWindup || Math.abs(u - Math.max(-uMax, Math.min(uMax, u))) < 0.01) {
                    integral += error * dt;
                }
                
                u = Kp * error + Ki * integral;
                
                // é£½å’Œ
                if (u > uMax) u = uMax;
                if (u < -uMax) u = -uMax;
                
                // ã‚·ã‚¹ãƒ†ãƒ å¿œç­”
                const dydt = -y + u;
                y += dydt * dt;
            }
            
            ctx.stroke();
            
            // ãƒ©ãƒ™ãƒ«
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            const label = antiWindup ? 'ã‚¢ãƒ³ãƒãƒ¯ã‚¤ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—ä»˜ãï¼ˆç·‘ï¼‰' : 'é€šå¸¸ã®PIåˆ¶å¾¡ï¼ˆèµ¤ï¼‰';
            ctx.fillText(label, 100, 30);
        }

        function drawAxes2(ctx, width, height, offsetY) {
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(50, offsetY);
            ctx.lineTo(width - 50, offsetY);
            ctx.stroke();
        }

        // åˆæœŸåŒ–
        runPIDSimulation();
    </script>
</body>
</html>