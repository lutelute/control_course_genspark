<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬6å›ï¼šå®‰å®šæ€§ã¨æ¥µ</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        .content { padding: 40px; }
        h2 {
            color: #30cfd0;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #30cfd0;
        }
        .highlight-box {
            background: #e0f7fa;
            border-left: 5px solid #30cfd0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .interactive-demo {
            background: #f0f8ff;
            border: 2px solid #4169e1;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
        }
        button {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 10px 5px;
        }
        button:hover { transform: translateY(-2px); }
        canvas {
            border: 2px solid #ddd;
            border-radius: 5px;
            display: block;
            margin: 20px auto;
            background: white;
        }
        .slider-container { margin: 15px 0; }
        input[type="range"] { width: 100%; margin: 10px 0; }
        .stability-indicator {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        .stable { background: #c8e6c9; color: #2e7d32; }
        .unstable { background: #ffcdd2; color: #c62828; }
        .marginal { background: #fff9c4; color: #f57f17; }
        .pole-display {
            font-family: 'Courier New', monospace;
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        ul { margin-left: 30px; margin-top: 10px; }
        li { margin: 8px 0; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš–ï¸ ç¬¬6å›ï¼šå®‰å®šæ€§ã¨æ¥µ</h1>
            <p style="font-size: 1.2em; opacity: 0.9;">Stability and Poles</p>
        </header>
        
        <div class="content">
            <div class="highlight-box">
                <h3>ğŸ¯ å­¦ç¿’ç›®æ¨™</h3>
                <ul>
                    <li>ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ã®æ¦‚å¿µã‚’ç†è§£ã™ã‚‹</li>
                    <li>æ¥µã¨å›ºæœ‰å€¤ã®é–¢ä¿‚ã‚’æŠŠæ¡ã™ã‚‹</li>
                    <li>Routh-Hurwitzã®å®‰å®šåˆ¤åˆ¥æ³•ã‚’å­¦ã¶</li>
                </ul>
            </div>

            <h2>1. å®‰å®šæ€§ã®å®šç¾©</h2>
            
            <div style="background: #f9f9f9; padding: 15px; margin: 15px 0; border-radius: 5px;">
                <h3>æ¥µã®ä½ç½®ã¨å®‰å®šæ€§</h3>
                <p><strong>æ¼¸è¿‘å®‰å®šï¼š</strong>ã™ã¹ã¦ã®æ¥µã®å®Ÿéƒ¨ãŒè² ï¼ˆå·¦åŠå¹³é¢ï¼‰</p>
                <p><strong>é™ç•Œå®‰å®šï¼š</strong>æ¥µãŒè™šè»¸ä¸Šï¼ˆå®Ÿéƒ¨ãŒã‚¼ãƒ­ï¼‰</p>
                <p><strong>ä¸å®‰å®šï¼š</strong>ã„ãšã‚Œã‹ã®æ¥µã®å®Ÿéƒ¨ãŒæ­£ï¼ˆå³åŠå¹³é¢ï¼‰</p>
            </div>

            <h2>2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢ï¼šæ¥µã¨å¿œç­”ã®é–¢ä¿‚</h2>
            
            <div class="interactive-demo">
                <h3>ğŸ”§ æ¥µã®ä½ç½®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</h3>
                
                <p>2æ¬¡ã‚·ã‚¹ãƒ†ãƒ ã®æ¥µ: \(\lambda_{1,2} = -\zeta\omega_n \pm j\omega_n\sqrt{1-\zeta^2}\)</p>
                
                <div class="slider-container">
                    <label>æ¸›è¡°ä¿‚æ•° Î¶ (zeta): <span id="zeta-value">0.5</span></label>
                    <input type="range" id="zeta-slider" min="-0.5" max="2" step="0.05" value="0.5">
                </div>
                
                <div class="slider-container">
                    <label>å›ºæœ‰è§’å‘¨æ³¢æ•° Ï‰â‚™: <span id="omega-value">2.0</span></label>
                    <input type="range" id="omega-slider" min="0.5" max="5" step="0.1" value="2">
                </div>
                
                <button onclick="updatePoles()">æ¥µã‚’æ›´æ–°</button>
                <button onclick="resetPoles()">ãƒªã‚»ãƒƒãƒˆ</button>
                
                <div id="stability-status" class="stability-indicator"></div>
                
                <div class="pole-display">
                    <h4>æ¥µã®ä½ç½®:</h4>
                    <pre id="pole-values"></pre>
                    <h4 style="margin-top: 10px;">æ€§èƒ½æŒ‡æ¨™:</h4>
                    <pre id="performance-metrics"></pre>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="text-align: center;">è¤‡ç´ å¹³é¢ï¼ˆså¹³é¢ï¼‰</h4>
                        <canvas id="pole-canvas" width="400" height="400"></canvas>
                    </div>
                    <div>
                        <h4 style="text-align: center;">ã‚¹ãƒ†ãƒƒãƒ—å¿œç­”</h4>
                        <canvas id="response-canvas" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>

            <h2>3. Routh-Hurwitzã®å®‰å®šåˆ¤åˆ¥</h2>
            
            <div class="interactive-demo">
                <h3>ğŸ§® Routhé…åˆ—è¨ˆç®—å™¨</h3>
                
                <p>ç‰¹æ€§å¤šé …å¼: \(s^3 + a_2s^2 + a_1s + a_0 = 0\)</p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div>
                        <label>aâ‚‚:</label>
                        <input type="number" id="routh-a2" value="3" step="0.1" style="width: 100%; padding: 5px;">
                    </div>
                    <div>
                        <label>aâ‚:</label>
                        <input type="number" id="routh-a1" value="3" step="0.1" style="width: 100%; padding: 5px;">
                    </div>
                    <div>
                        <label>aâ‚€:</label>
                        <input type="number" id="routh-a0" value="1" step="0.1" style="width: 100%; padding: 5px;">
                    </div>
                </div>
                
                <button onclick="calculateRouth()">Routhé…åˆ—ã‚’è¨ˆç®—</button>
                
                <div class="pole-display">
                    <h4>Routhé…åˆ—:</h4>
                    <pre id="routh-array"></pre>
                    <h4 style="margin-top: 10px;">åˆ¤å®šçµæœ:</h4>
                    <pre id="routh-result"></pre>
                </div>
            </div>

            <h2>4. ã¾ã¨ã‚</h2>
            <div class="highlight-box">
                <ul>
                    <li>ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šæ€§ã¯æ¥µï¼ˆå›ºæœ‰å€¤ï¼‰ã®ä½ç½®ã§æ±ºã¾ã‚‹</li>
                    <li>å·¦åŠå¹³é¢ã®æ¥µ â†’ æ¼¸è¿‘å®‰å®š</li>
                    <li>Routh-Hurwitzæ³•ã«ã‚ˆã‚Šå›ºæœ‰å€¤ã‚’è¨ˆç®—ã›ãšã«å®‰å®šæ€§åˆ¤å®šå¯èƒ½</li>
                    <li>æ¸›è¡°ä¿‚æ•°Î¶ã¯ç›¸å¯¾å®‰å®šåº¦ã®æŒ‡æ¨™</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('zeta-slider').addEventListener('input', function() {
            document.getElementById('zeta-value').textContent = this.value;
        });
        
        document.getElementById('omega-slider').addEventListener('input', function() {
            document.getElementById('omega-value').textContent = this.value;
        });

        function updatePoles() {
            const zeta = parseFloat(document.getElementById('zeta-slider').value);
            const omega = parseFloat(document.getElementById('omega-slider').value);
            
            // æ¥µã®è¨ˆç®—
            let pole1_real, pole1_imag, pole2_real, pole2_imag;
            
            if (zeta < 1) {
                pole1_real = pole2_real = -zeta * omega;
                pole1_imag = omega * Math.sqrt(1 - zeta * zeta);
                pole2_imag = -pole1_imag;
            } else {
                pole1_real = -zeta * omega + omega * Math.sqrt(zeta * zeta - 1);
                pole2_real = -zeta * omega - omega * Math.sqrt(zeta * zeta - 1);
                pole1_imag = pole2_imag = 0;
            }
            
            // å®‰å®šæ€§åˆ¤å®š
            let stability = '';
            if (pole1_real < 0 && pole2_real < 0) {
                stability = 'æ¼¸è¿‘å®‰å®šï¼ˆAsymptotically Stableï¼‰';
                document.getElementById('stability-status').className = 'stability-indicator stable';
            } else if (pole1_real === 0 || pole2_real === 0) {
                stability = 'é™ç•Œå®‰å®šï¼ˆMarginally Stableï¼‰';
                document.getElementById('stability-status').className = 'stability-indicator marginal';
            } else {
                stability = 'ä¸å®‰å®šï¼ˆUnstableï¼‰';
                document.getElementById('stability-status').className = 'stability-indicator unstable';
            }
            document.getElementById('stability-status').textContent = stability;
            
            // æ¥µã®è¡¨ç¤º
            let poleText = '';
            if (pole1_imag === 0) {
                poleText = `Î»â‚ = ${pole1_real.toFixed(3)}\nÎ»â‚‚ = ${pole2_real.toFixed(3)}`;
            } else {
                poleText = `Î»â‚ = ${pole1_real.toFixed(3)} + ${Math.abs(pole1_imag).toFixed(3)}j\nÎ»â‚‚ = ${pole2_real.toFixed(3)} - ${Math.abs(pole1_imag).toFixed(3)}j`;
            }
            document.getElementById('pole-values').textContent = poleText;
            
            // æ€§èƒ½æŒ‡æ¨™
            const settling_time = zeta > 0 ? 4 / (zeta * omega) : Infinity;
            const overshoot = zeta < 1 && zeta > 0 ? Math.exp(-Math.PI * zeta / Math.sqrt(1 - zeta * zeta)) * 100 : 0;
            
            document.getElementById('performance-metrics').textContent = 
                `æ•´å®šæ™‚é–“ (2%): ${settling_time.toFixed(3)} s\nã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ãƒˆ: ${overshoot.toFixed(1)} %`;
            
            // ã‚°ãƒ©ãƒ•æç”»
            drawPoles(pole1_real, pole1_imag, pole2_real, pole2_imag);
            drawResponse(zeta, omega);
        }

        function drawPoles(r1, i1, r2, i2) {
            const canvas = document.getElementById('pole-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;
            
            // è»¸
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            // å·¦åŠå¹³é¢ã®è‰²ä»˜ã‘
            ctx.fillStyle = 'rgba(200, 230, 201, 0.3)';
            ctx.fillRect(0, 0, centerX, canvas.height);
            
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('å·¦åŠå¹³é¢', 50, 30);
            ctx.fillText('(å®‰å®š)', 60, 50);
            ctx.fillText('å³åŠå¹³é¢', canvas.width - 100, 30);
            ctx.fillText('(ä¸å®‰å®š)', canvas.width - 100, 50);
            ctx.fillText('Re', canvas.width - 30, centerY - 10);
            ctx.fillText('Im', centerX + 10, 20);
            
            // æ¥µã®æç”»
            ctx.fillStyle = '#e91e63';
            ctx.beginPath();
            ctx.arc(centerX + r1 * scale, centerY - i1 * scale, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(centerX + r2 * scale, centerY - i2 * scale, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // Ã—å°
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX + r1 * scale - 5, centerY - i1 * scale - 5);
            ctx.lineTo(centerX + r1 * scale + 5, centerY - i1 * scale + 5);
            ctx.moveTo(centerX + r1 * scale + 5, centerY - i1 * scale - 5);
            ctx.lineTo(centerX + r1 * scale - 5, centerY - i1 * scale + 5);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX + r2 * scale - 5, centerY - i2 * scale - 5);
            ctx.lineTo(centerX + r2 * scale + 5, centerY - i2 * scale + 5);
            ctx.moveTo(centerX + r2 * scale + 5, centerY - i2 * scale - 5);
            ctx.lineTo(centerX + r2 * scale - 5, centerY - i2 * scale + 5);
            ctx.stroke();
        }

        function drawResponse(zeta, omega) {
            const canvas = document.getElementById('response-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è»¸
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 20, canvas.height - 50);
            ctx.moveTo(50, 20);
            ctx.lineTo(50, canvas.height - 50);
            ctx.stroke();
            
            const tMax = 10;
            const dt = 0.01;
            const steps = tMax / dt;
            
            const scaleX = (canvas.width - 70) / tMax;
            const scaleY = 250;
            const offsetY = canvas.height - 50;
            
            // ã‚¹ãƒ†ãƒƒãƒ—å¿œç­”ã®è¨ˆç®—ã¨æç”»
            ctx.strokeStyle = '#30cfd0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < steps; i++) {
                const t = i * dt;
                let y;
                
                if (zeta < 1 && zeta > 0) {
                    // ä¸è¶³æ¸›è¡°
                    const wd = omega * Math.sqrt(1 - zeta * zeta);
                    y = 1 - Math.exp(-zeta * omega * t) * 
                        (Math.cos(wd * t) + zeta / Math.sqrt(1 - zeta * zeta) * Math.sin(wd * t));
                } else if (zeta === 1) {
                    // è‡¨ç•Œæ¸›è¡°
                    y = 1 - Math.exp(-omega * t) * (1 + omega * t);
                } else if (zeta > 1) {
                    // éæ¸›è¡°
                    const s1 = -zeta * omega + omega * Math.sqrt(zeta * zeta - 1);
                    const s2 = -zeta * omega - omega * Math.sqrt(zeta * zeta - 1);
                    y = 1 + (s2 * Math.exp(s1 * t) - s1 * Math.exp(s2 * t)) / (s2 - s1);
                } else {
                    // ä¸å®‰å®š
                    const wd = omega * Math.sqrt(1 - zeta * zeta);
                    y = 1 - Math.exp(-zeta * omega * t) * 
                        (Math.cos(wd * t) + zeta / Math.sqrt(1 - zeta * zeta) * Math.sin(wd * t));
                }
                
                const x = 50 + t * scaleX;
                const py = offsetY - y * scaleY;
                
                if (i === 0) ctx.moveTo(x, py);
                else ctx.lineTo(x, py);
            }
            ctx.stroke();
            
            // ç›®æ¨™å€¤ã®ãƒ©ã‚¤ãƒ³
            ctx.strokeStyle = '#999';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(50, offsetY - scaleY);
            ctx.lineTo(canvas.width - 20, offsetY - scaleY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('æ™‚é–“ (s)', canvas.width - 60, canvas.height - 30);
            ctx.fillText('å‡ºåŠ›', 20, 30);
        }

        function resetPoles() {
            document.getElementById('zeta-slider').value = 0.5;
            document.getElementById('omega-slider').value = 2;
            document.getElementById('zeta-value').textContent = '0.5';
            document.getElementById('omega-value').textContent = '2.0';
            updatePoles();
        }

        function calculateRouth() {
            const a2 = parseFloat(document.getElementById('routh-a2').value);
            const a1 = parseFloat(document.getElementById('routh-a1').value);
            const a0 = parseFloat(document.getElementById('routh-a0').value);
            
            // Routhé…åˆ—ã®è¨ˆç®—
            const r30 = 1;
            const r31 = a1;
            const r20 = a2;
            const r21 = a0;
            const r10 = (a2 * a1 - a0) / a2;
            const r00 = a0;
            
            let arrayText = `sÂ³ | ${r30}     ${r31}\n`;
            arrayText += `sÂ² | ${a2}     ${a0}\n`;
            arrayText += `sÂ¹ | ${r10.toFixed(4)}     0\n`;
            arrayText += `sâ° | ${r00}`;
            
            document.getElementById('routh-array').textContent = arrayText;
            
            // å®‰å®šæ€§åˆ¤å®š
            const firstColumn = [r30, r20, r10, r00];
            let signChanges = 0;
            for (let i = 0; i < firstColumn.length - 1; i++) {
                if (firstColumn[i] * firstColumn[i+1] < 0) {
                    signChanges++;
                }
            }
            
            let result = '';
            if (signChanges === 0 && firstColumn.every(x => x > 0)) {
                result = 'âœ“ å®‰å®šï¼ˆã™ã¹ã¦ã®æ¥µãŒå·¦åŠå¹³é¢ï¼‰\nç¬¬1åˆ—ã®ç¬¦å·å¤‰åŒ–ãªã—';
            } else {
                result = `âœ— ä¸å®‰å®š\nå³åŠå¹³é¢ã®æ ¹ã®æ•°: ${signChanges}`;
            }
            
            document.getElementById('routh-result').textContent = result;
        }

        // åˆæœŸåŒ–
        updatePoles();
        calculateRouth();
    </script>
</body>
</html>